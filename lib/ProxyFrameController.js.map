{"version":3,"sources":["lib/ProxyFrameController.js"],"names":["popWindow","url","id","w","h","dualScreenLeft","window","screenLeft","undefined","screen","left","dualScreenTop","screenTop","top","width","outerWidth","height","innerHeight","newWindow","open","focus","e","ProxyFrameController","prefix","oAuthCallback","callbackUri","parent","postMessage","addEventListener","data","oAuthUri","key","newValue","fromLocalStorage","localStorage","removeItem","proxyLoaded"],"mappings":";;;;;;;;;;;;;AACA,SAASA,SAAT,CAAmBC,GAAnB,EAAwBC,EAAxB,EAA4BC,CAA5B,EAA+BC,CAA/B,EAAkC;AAChC;AACA,MAAMC,iBAAiBC,OAAOC,UAAP,KAAsBC,SAAtB,GAAkCF,OAAOC,UAAzC,GAAsDE,OAAOC,IAApF;AACA,MAAMC,gBAAgBL,OAAOM,SAAP,KAAqBJ,SAArB,GAAiCF,OAAOM,SAAxC,GAAoDH,OAAOI,GAAjF;;AAEA,MAAMC,QAAQL,OAAOK,KAAP,IAAgBR,OAAOS,UAArC;AACA,MAAMC,SAASP,OAAOO,MAAP,IAAiBV,OAAOW,WAAvC;;AAEA,MAAMP,OAASI,QAAQ,CAAT,GAAeX,IAAI,CAApB,GAA0BE,cAAvC;AACA,MAAMQ,MAAQG,SAAS,CAAV,GAAgBZ,IAAI,CAArB,GAA2BO,aAAvC;AACA,MAAMO,YAAYZ,OAAOa,IAAP,CAChBlB,GADgB,EAEhBC,EAFgB,6BAGSC,CAHT,iBAGsBC,CAHtB,cAGgCS,GAHhC,eAG6CH,IAH7C,CAAlB;;AAMA;AACA,MAAIJ,OAAOc,KAAX,EAAkB;AAChB,QAAI;AACFF,gBAAUE,KAAV;AACD,KAFD,CAEE,OAAOC,CAAP,EAAU;AACV;AACD;AACF;AACD,SAAOH,SAAP;AACD;;IAEoBI,oB,GACnB,gCAEQ;AAAA,iFAAJ,EAAI;AAAA,MADNC,MACM,QADNA,MACM;;AAAA;;AACNjB,SAAOkB,aAAP,GAAuB,UAACC,WAAD,EAAiB;AACtCnB,WAAOoB,MAAP,CAAcC,WAAd,CAA0B;AACxBF;AADwB,KAA1B,EAEG,GAFH;AAGD,GAJD;;AAMAnB,SAAOsB,gBAAP,CAAwB,SAAxB,EAAmC,iBAAc;AAAA,QAAXC,IAAW,SAAXA,IAAW;;AAC/C,QAAIA,IAAJ,EAAU;AAAA,UAENC,QAFM,GAGJD,IAHI,CAENC,QAFM;;AAIR,UAAIA,YAAY,IAAhB,EAAsB;AACpB9B,kBAAU8B,QAAV,EAAoB,UAApB,EAAgC,GAAhC,EAAqC,GAArC;AACD;AACF;AACF,GATD;;AAWA,MAAMC,MAASR,MAAT,0BAAN;AACAjB,SAAOsB,gBAAP,CAAwB,SAAxB,EAAmC,UAACP,CAAD,EAAO;AACxC,QAAIA,EAAEU,GAAF,KAAUA,GAAV,IAAiBV,EAAEW,QAAnB,IAA+BX,EAAEW,QAAF,KAAe,EAAlD,EAAsD;AACpD,UAAMP,cAAcJ,EAAEW,QAAtB;AACA1B,aAAOoB,MAAP,CAAcC,WAAd,CAA0B;AACxBF,gCADwB;AAExBQ,0BAAkB;AAFM,OAA1B,EAGG,GAHH;AAIAC,mBAAaC,UAAb,CAAwBJ,GAAxB;AACD;AACF,GATD;AAUA;AACAzB,SAAOoB,MAAP,CAAcC,WAAd,CAA0B;AACxBS,iBAAa;AADW,GAA1B,EAEG,GAFH;AAGD,C;;kBApCkBd,oB","file":"ProxyFrameController.js","sourcesContent":["\nfunction popWindow(url, id, w, h) {\n  // Fixes dual-screen position                         Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;\n\n  const width = screen.width || window.outerWidth;\n  const height = screen.height || window.innerHeight;\n\n  const left = ((width / 2) - (w / 2)) + dualScreenLeft;\n  const top = ((height / 2) - (h / 2)) + dualScreenTop;\n  const newWindow = window.open(\n    url,\n    id,\n    `scrollbars=yes, width=${w}, height=${h}, top=${top}, left=${left}`,\n  );\n\n  // Puts focus on the newWindow\n  if (window.focus) {\n    try {\n      newWindow.focus();\n    } catch (e) {\n      /* falls through */\n    }\n  }\n  return newWindow;\n}\n\nexport default class ProxyFrameController {\n  constructor({\n    prefix,\n  } = {}) {\n    window.oAuthCallback = (callbackUri) => {\n      window.parent.postMessage({\n        callbackUri,\n      }, '*');\n    };\n\n    window.addEventListener('message', ({ data }) => {\n      if (data) {\n        const {\n          oAuthUri,\n        } = data;\n        if (oAuthUri != null) {\n          popWindow(oAuthUri, 'rc-oauth', 600, 600);\n        }\n      }\n    });\n\n    const key = `${prefix}-redirect-callbackUri`;\n    window.addEventListener('storage', (e) => {\n      if (e.key === key && e.newValue && e.newValue !== '') {\n        const callbackUri = e.newValue;\n        window.parent.postMessage({\n          callbackUri,\n          fromLocalStorage: true,\n        }, '*');\n        localStorage.removeItem(key);\n      }\n    });\n    // loaded\n    window.parent.postMessage({\n      proxyLoaded: true,\n    }, '*');\n  }\n}\n"]}