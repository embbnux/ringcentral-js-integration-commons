{"version":3,"sources":["lib/EventTransport/index.js"],"names":["EventTransport","options","name","_deferred","payload","requestId","v4","promise","resolve","reject","set","timeoutId","setTimeout","get","Error","_events","timeout","_timeout","then","result","clearTimeout","delete","catch","error","emit","request","deferred","push"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;IAGqBA,c;;;AACnB,0BAAYC,OAAZ,EAAqB;AAAA;;AAAA,iLAEdA,OAFc;AAGjBC,YAAM;AAHW;;AAKnB,UAAKC,SAAL,GAAiB,mBAAjB;AALmB;AAMpB;;;;;;;;YACeC,O,SAAAA,O;;;;;;AACRC,yB,GAAY,eAAKC,EAAL,E;AACZC,uB,GAAU,sBAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC/C,yBAAKN,SAAL,CAAeO,GAAf,CAAmBL,SAAnB,EAA8B;AAC5BG,oCAD4B;AAE5BC;AAF4B,mBAA9B;AAID,iBALe,C;AAMZE,yB,GAAYC,WAAW,YAAM;AAC/BD,8BAAY,IAAZ;AACA,yBAAKR,SAAL,CAAeU,GAAf,CAAmBR,SAAnB,EAA8BI,MAA9B,CAAqC,IAAIK,KAAJ,CAAU,OAAKC,OAAL,CAAaC,OAAvB,CAArC;AACD,iBAHe,EAGb,KAAKC,QAHQ,C;;AAIhBV,wBAAQW,IAAR,CAAa,UAACC,MAAD,EAAY;AACvB,sBAAIR,SAAJ,EAAeS,aAAaT,SAAb;AACf,yBAAKR,SAAL,CAAekB,MAAf,CAAsBhB,SAAtB;AACA,yBAAO,kBAAQG,OAAR,CAAgBW,MAAhB,CAAP;AACD,iBAJD,EAIGG,KAJH,CAIS,UAACC,KAAD,EAAW;AAClB,sBAAIZ,SAAJ,EAAeS,aAAaT,SAAb;AACf,yBAAKR,SAAL,CAAekB,MAAf,CAAsBhB,SAAtB;AACA,yBAAO,kBAAQI,MAAR,CAAec,KAAf,CAAP;AACD,iBARD;AASA,qBAAKC,IAAL,CAAU,KAAKT,OAAL,CAAaU,OAAvB,EAAgC;AAC9BpB,sCAD8B;AAE9BD;AAF8B,iBAAhC;iDAIOG,O;;;;;;;;;;;;;;;;;;oCAE8B;AAAA,UAA5BF,SAA4B,SAA5BA,SAA4B;AAAA,UAAjBc,MAAiB,SAAjBA,MAAiB;AAAA,UAATI,KAAS,SAATA,KAAS;;AACrC,UAAMG,WAAW,KAAKvB,SAAL,CAAeU,GAAf,CAAmBR,SAAnB,CAAjB;AACA,UAAIqB,QAAJ,EAAc;AACZ,YAAIH,KAAJ,EAAW;AACTG,mBAASjB,MAAT,CAAgBc,KAAhB;AACD,SAFD,MAEO;AACLG,mBAASlB,OAAT,CAAiBW,MAAjB;AACD;AACF;AACF;;;gCACiB;AAAA,UAAXf,OAAW,SAAXA,OAAW;;AAChB,WAAKoB,IAAL,CAAU,KAAKT,OAAL,CAAaY,IAAvB,EAA6BvB,OAA7B;AACD;;;;;kBA/CkBJ,c","file":"index.js","sourcesContent":["import uuid from 'uuid';\r\nimport TransportBase from '../TransportBase';\r\n\r\n\r\nexport default class EventTransport extends TransportBase {\r\n  constructor(options) {\r\n    super({\r\n      ...options,\r\n      name: 'EventTransport',\r\n    });\r\n    this._deferred = new Map();\r\n  }\r\n  async request({ payload }) {\r\n    const requestId = uuid.v4();\r\n    const promise = new Promise((resolve, reject) => {\r\n      this._deferred.set(requestId, {\r\n        resolve,\r\n        reject,\r\n      });\r\n    });\r\n    let timeoutId = setTimeout(() => {\r\n      timeoutId = null;\r\n      this._deferred.get(requestId).reject(new Error(this._events.timeout));\r\n    }, this._timeout);\r\n    promise.then((result) => {\r\n      if (timeoutId) clearTimeout(timeoutId);\r\n      this._deferred.delete(requestId);\r\n      return Promise.resolve(result);\r\n    }).catch((error) => {\r\n      if (timeoutId) clearTimeout(timeoutId);\r\n      this._deferred.delete(requestId);\r\n      return Promise.reject(error);\r\n    });\r\n    this.emit(this._events.request, {\r\n      requestId,\r\n      payload,\r\n    });\r\n    return promise;\r\n  }\r\n  response({ requestId, result, error }) {\r\n    const deferred = this._deferred.get(requestId);\r\n    if (deferred) {\r\n      if (error) {\r\n        deferred.reject(error);\r\n      } else {\r\n        deferred.resolve(result);\r\n      }\r\n    }\r\n  }\r\n  push({ payload }) {\r\n    this.emit(this._events.push, payload);\r\n  }\r\n}\r\n"]}