{"version":3,"sources":["lib/RedirectController.js"],"names":["RedirectController","prefix","window","addEventListener","callbackUri","location","href","opener","oAuthCallback","close","key","localStorage","removeItem","e","newValue","setItem"],"mappings":";;;;;;;;;;;;;IACqBA,kB,GACnB,8BAEQ;AAAA,iFAAJ,EAAI;AAAA,MADNC,MACM,QADNA,MACM;;AAAA;;AACNC,SAAOC,gBAAP,CAAwB,MAAxB,EAAgC,YAAM;AACpC,QAAMC,cAAcF,OAAOG,QAAP,CAAgBC,IAApC;AACA,QAAIJ,OAAOK,MAAP,IAAiBL,OAAOK,MAAP,CAAcC,aAAnC,EAAkD;AAChDN,aAAOK,MAAP,CAAcC,aAAd,CAA4BJ,WAA5B;AACAF,aAAOO,KAAP;AACD,KAHD,MAGO;AAAA;AACL;AACA,YAAMC,MAAST,MAAT,0BAAN;AACAU,qBAAaC,UAAb,CAAwBF,GAAxB;AACAR,eAAOC,gBAAP,CAAwB,SAAxB,EAAmC,UAACU,CAAD,EAAO;AACxC,cAAIA,EAAEH,GAAF,KAAUA,GAAV,KAAkB,CAACG,EAAEC,QAAH,IAAeD,EAAEC,QAAF,KAAe,EAAhD,CAAJ,EAAyD;AACvDZ,mBAAOO,KAAP;AACD;AACF,SAJD;AAKAE,qBAAaI,OAAb,CAAqBL,GAArB,EAA0BN,WAA1B;AATK;AAUN;AACF,GAhBD;AAiBD,C;;kBArBkBJ,kB","file":"RedirectController.js","sourcesContent":["\nexport default class RedirectController {\n  constructor({\n    prefix,\n  } = {}) {\n    window.addEventListener('load', () => {\n      const callbackUri = window.location.href;\n      if (window.opener && window.opener.oAuthCallback) {\n        window.opener.oAuthCallback(callbackUri);\n        window.close();\n      } else {\n        // fall back to use localStorage as a vessel to avoid opener is null bug\n        const key = `${prefix}-redirect-callbackUri`;\n        localStorage.removeItem(key);\n        window.addEventListener('storage', (e) => {\n          if (e.key === key && (!e.newValue || e.newValue === '')) {\n            window.close();\n          }\n        });\n        localStorage.setItem(key, callbackUri);\n      }\n    });\n  }\n}\n"]}