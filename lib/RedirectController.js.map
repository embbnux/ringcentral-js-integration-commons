{"version":3,"sources":["lib/RedirectController.js"],"names":["RedirectController","prefix","window","addEventListener","callbackUri","location","href","opener","oAuthCallback","close","e","key","localStorage","removeItem","newValue","setItem"],"mappings":";;;;;;;;;;;;;IACqBA,kB,GACnB,8BAEQ;AAAA,iFAAJ,EAAI;AAAA,MADNC,MACM,QADNA,MACM;;AAAA;;AACNC,SAAOC,gBAAP,CAAwB,MAAxB,EAAgC,YAAM;AACpC,QAAMC,cAAcF,OAAOG,QAAP,CAAgBC,IAApC;AACA;AACA;AACA,QAAI;AACF,UAAIJ,OAAOK,MAAP,IAAiBL,OAAOK,MAAP,CAAcC,aAAnC,EAAkD;AAChDN,eAAOK,MAAP,CAAcC,aAAd,CAA4BJ,WAA5B;AACAF,eAAOO,KAAP;AACA;AACD;AACF,KAND,CAME,OAAOC,CAAP,EAAU,CAEX;AADC;;AAEF;AACA,QAAMC,MAASV,MAAT,0BAAN;AACAW,iBAAaC,UAAb,CAAwBF,GAAxB;AACAT,WAAOC,gBAAP,CAAwB,SAAxB,EAAmC,UAACO,CAAD,EAAO;AACxC,UAAIA,EAAEC,GAAF,KAAUA,GAAV,KAAkB,CAACD,EAAEI,QAAH,IAAeJ,EAAEI,QAAF,KAAe,EAAhD,CAAJ,EAAyD;AACvDZ,eAAOO,KAAP;AACD;AACF,KAJD;AAKAG,iBAAaG,OAAb,CAAqBJ,GAArB,EAA0BP,WAA1B;AACD,GAtBD;AAuBD,C;;kBA3BkBJ,kB","file":"RedirectController.js","sourcesContent":["\nexport default class RedirectController {\n  constructor({\n    prefix,\n  } = {}) {\n    window.addEventListener('load', () => {\n      const callbackUri = window.location.href;\n      // RCINT-3477 some devices will have reference to opener, but will throw exception\n      // when tring to access opener\n      try {\n        if (window.opener && window.opener.oAuthCallback) {\n          window.opener.oAuthCallback(callbackUri);\n          window.close();\n          return;\n        }\n      } catch (e) {\n        /* ignore error */\n      }\n      // fall back to use localStorage as a vessel to avoid opener is null bug\n      const key = `${prefix}-redirect-callbackUri`;\n      localStorage.removeItem(key);\n      window.addEventListener('storage', (e) => {\n        if (e.key === key && (!e.newValue || e.newValue === '')) {\n          window.close();\n        }\n      });\n      localStorage.setItem(key, callbackUri);\n    });\n  }\n}\n"]}