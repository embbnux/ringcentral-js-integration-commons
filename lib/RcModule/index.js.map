{"version":3,"sources":["lib/RcModule/index.js"],"names":["defaultReducer","defaultGetState","store","getState","RcModule","prefix","actionTypes","Error","_getState","_prefix","_actionTypes","enumMap","_reducer","_modulePath","_selectors","addSelector","name","module","Object","prototype","hasOwnProperty","get","enumerable","modulePath","args","selector","pop","length","_store","_setStore","_initModule","subModule","_suppressInit","_initialized","initialize","getSelector"],"mappings":"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","file":"index.js","sourcesContent":["import { createSelector } from 'reselect';\nimport { prefixEnum } from '../Enum';\n\n/**\n * @function\n * @param {Object} state\n * @return {Object}\n * @description Default reducer if module does not has its own reducer.\n */\nfunction defaultReducer() {\n  return null;\n}\n\n/**\n * @function\n * @return any\n * @description Default getState function\n */\nfunction defaultGetState() {\n  return this.store.getState();\n}\n\n/**\n * @class\n * @default\n * @description Base module class.\n */\nexport default class RcModule {\n  /**\n   * @constructor\n   * @param {Function} options.getState\n   * @param {String} options.prefix\n   * @param {Enum} options.actionTypes,\n   */\n  constructor({\n    getState = defaultGetState,\n    prefix,\n    actionTypes,\n  } = {}) {\n    if (typeof getState !== 'function') {\n      throw new Error(\n        'The `getState` options property must be of type function'\n      );\n    }\n    this._getState = getState;\n    if (prefix && typeof prefix !== 'string') {\n      throw new Error('The `prefix` options property must be null, undefined, or a string');\n    }\n    this._prefix = prefix;\n    this._actionTypes = actionTypes && prefixEnum({ enumMap: actionTypes, prefix });\n    this._reducer = defaultReducer;\n    this._modulePath = 'root';\n    this._selectors = {};\n    // add state selector\n\n    this.addSelector('state', () => this::this._getState());\n  }\n\n  /**\n   * @property\n   * @type any\n   * @description The state of the module\n   */\n  get state() {\n    return this.getSelector('state')();\n  }\n\n  /**\n   * @property\n   * @type Function\n   * @description The reducer function of the module\n   */\n  get reducer() {\n    return this._reducer;\n  }\n\n  /**\n   * @property\n   * @type Object\n   * @description The store object of the module\n   */\n  get store() {\n    if (!this._store) {\n      throw new Error('module has not been initialized...');\n    }\n    return this._store;\n  }\n  /**\n   * @property\n   * @type String\n   * @description The prefix string of this module\n   */\n  get prefix() {\n    return this._prefix;\n  }\n  /**\n   * @property\n   * @type Enum\n   * @description The actionTypes used by the module\n   */\n  get actionTypes() {\n    return this._actionTypes;\n  }\n  /**\n   * @property\n   * @type String\n   * @description The canonical path of the module from the root module\n   */\n  get modulePath() {\n    return this._modulePath;\n  }\n\n  /**\n   * @function addModule\n   * @param {String} name - Name of the module. Also used for the property name.\n   * @param {any} module - The module to be attached, can be any type.\n   * @description Add the desired module to the\n   */\n  addModule(name, module) {\n    if (this::Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    // tag submodule with a modulePath for proxying function calls\n    // do nothing if module is already tagged\n    if (this[name]._modulePath === 'root') {\n      this[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @description Add the selector to the internal selector object.\n   *  This is intended to be called with this.addSelector(name, selectorFn) or\n   *  this.addSelector(name, [...dependenciesFns], selectorFn);\n   */\n  addSelector(name, ...args) {\n    if (this._selectors::Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Selector '${name}' already exists...`);\n    }\n    const selector = args.pop();\n    if (args.length > 0) {\n      this._selectors[name] = createSelector(...args, selector);\n    } else {\n      this._selectors[name] = selector;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @return {Function}\n   * @description Returns the named selector function\n   */\n  getSelector(name) {\n    return this._selectors[name];\n  }\n\n  /**\n   * @function\n   * @param {Object} store\n   * @description Set the store to the modules and initialize the modules.\n   *   This should only be called once.\n   */\n  setStore(store) {\n    if (this._modulePath !== 'root') {\n      throw new Error('setStore should only be called on root module');\n    }\n    if (!store) {\n      throw new Error('setStore must accept a store object');\n    }\n    if (this._store) {\n      throw new Error('setStore should only be called once');\n    }\n    this._setStore(store);\n    this._initModule();\n  }\n  _setStore(store) {\n    this._store = store;\n    for (const subModule in this) {\n      if (\n        this::Object.prototype.hasOwnProperty(subModule) &&\n        this[subModule] instanceof RcModule\n      ) {\n        this[subModule]._setStore(store);\n      }\n    }\n  }\n  _initModule() {\n    if (\n      !this._suppressInit &&\n      !this._initialized &&\n      typeof this.initialize === 'function'\n    ) {\n      this._initialized = true;\n      this.initialize();\n    }\n    for (const subModule in this) {\n      if (\n        this::Object.prototype.hasOwnProperty(subModule) &&\n        this[subModule] instanceof RcModule\n      ) {\n        this[subModule]._initModule();\n      }\n    }\n  }\n}\n"]}