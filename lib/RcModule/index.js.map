{"version":3,"sources":["lib/RcModule/index.js"],"names":["defaultReducer","defaultGetState","store","getState","defaultGetProxyState","RcModule","getProxyState","prefix","actionTypes","Error","_getState","_getProxyState","_prefix","_actionTypes","enumMap","_reducer","_proxyReducer","_modulePath","_selectors","name","module","Object","prototype","hasOwnProperty","get","enumerable","modulePath","args","selector","pop","length","_store","_setStore","_initModule","subModule","_suppressInit","_initialized","initialize","ready","status","pending","proxyStatus"],"mappings":"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","file":"index.js","sourcesContent":["import { createSelector } from 'reselect';\nimport { prefixEnum } from '../Enum';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport proxyStatuses from '../../enums/proxyStatuses';\n\n/**\n * @function\n * @param {Object} state\n * @return {Object}\n * @description Default reducer if module does not has its own reducer.\n */\nfunction defaultReducer() {\n  return null;\n}\n\n/**\n * @function\n * @return any\n * @description Default getState function\n */\nfunction defaultGetState() {\n  return this.store.getState();\n}\n\nfunction defaultGetProxyState() {\n  return {};\n}\n\n/**\n * @class\n * @default\n * @description Base module class.\n */\nexport default class RcModule {\n  /**\n   * @constructor\n   * @param {Function} options.getState\n   * @param {String} options.prefix\n   * @param {Enum} options.actionTypes,\n   */\n  constructor({\n    getState = defaultGetState,\n    getProxyState = defaultGetProxyState,\n    prefix,\n    actionTypes,\n  } = {}) {\n    if (typeof getState !== 'function') {\n      throw new Error(\n        'The `getState` options property must be of type function'\n      );\n    }\n    this._getState = getState;\n    this._getProxyState = getProxyState;\n    if (prefix && typeof prefix !== 'string') {\n      throw new Error('The `prefix` options property must be null, undefined, or a string');\n    }\n    this._prefix = prefix;\n    this._actionTypes = actionTypes && prefixEnum({ enumMap: actionTypes, prefix });\n    this._reducer = defaultReducer;\n    this._proxyReducer = defaultReducer;\n    this._modulePath = 'root';\n    this._selectors = {};\n  }\n\n  /**\n   * @property\n   * @type any\n   * @description The state of the module\n   */\n  get state() {\n    return this._getState();\n  }\n  get proxyState() {\n    return this._getProxyState();\n  }\n\n  /**\n   * @property\n   * @type Function\n   * @description The reducer function of the module\n   */\n  get reducer() {\n    return this._reducer;\n  }\n\n  get proxyReducer() {\n    return this._proxyReducer;\n  }\n\n  /**\n   * @property\n   * @type Object\n   * @description The store object of the module\n   */\n  get store() {\n    if (!this._store) {\n      throw new Error('module has not been initialized...');\n    }\n    return this._store;\n  }\n  /**\n   * @property\n   * @type String\n   * @description The prefix string of this module\n   */\n  get prefix() {\n    return this._prefix;\n  }\n  /**\n   * @property\n   * @type Enum\n   * @description The actionTypes used by the module\n   */\n  get actionTypes() {\n    return this._actionTypes;\n  }\n  /**\n   * @property\n   * @type String\n   * @description The canonical path of the module from the root module\n   */\n  get modulePath() {\n    return this._modulePath;\n  }\n\n  /**\n   * @function addModule\n   * @param {String} name - Name of the module. Also used for the property name.\n   * @param {any} module - The module to be attached, can be any type.\n   * @description Add the desired module to the\n   */\n  addModule(name, module) {\n    if (this::Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    // tag submodule with a modulePath for proxying function calls\n    // do nothing if module is already tagged\n    if (this[name]._modulePath === 'root') {\n      this[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @description Add the selector to the internal selector object.\n   *  This is intended to be called with this.addSelector(name, selectorFn) or\n   *  this.addSelector(name, [...dependenciesFns], selectorFn);\n   */\n  addSelector(name, ...args) {\n    if (this._selectors::Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Selector '${name}' already exists...`);\n    }\n    const selector = args.pop();\n    if (args.length > 0) {\n      this._selectors[name] = createSelector(...args, selector);\n    } else {\n      this._selectors[name] = selector;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @return {Function}\n   * @description Returns the named selector function\n   */\n  getSelector(name) {\n    return this._selectors[name];\n  }\n\n  /**\n   * @function\n   * @param {Object} store\n   * @description Set the store to the modules and initialize the modules.\n   *   This should only be called once.\n   */\n  setStore(store) {\n    if (this._modulePath !== 'root') {\n      throw new Error('setStore should only be called on root module');\n    }\n    if (!store) {\n      throw new Error('setStore must accept a store object');\n    }\n    if (this._store) {\n      throw new Error('setStore should only be called once');\n    }\n    this._setStore(store);\n    this._initModule();\n  }\n  _setStore(store) {\n    this._store = store;\n    for (const subModule in this) {\n      if (\n        this::Object.prototype.hasOwnProperty(subModule) &&\n        this[subModule] instanceof RcModule\n      ) {\n        this[subModule]._setStore(store);\n      }\n    }\n  }\n  _initModule() {\n    if (\n      !this._suppressInit &&\n      !this._initialized &&\n      typeof this.initialize === 'function'\n    ) {\n      this._initialized = true;\n      this.initialize();\n    }\n    for (const subModule in this) {\n      if (\n        this::Object.prototype.hasOwnProperty(subModule) &&\n        this[subModule] instanceof RcModule\n      ) {\n        this[subModule]._initModule();\n      }\n    }\n  }\n\n  get status() {\n    return moduleStatuses.ready;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.status === moduleStatuses.pending;\n  }\n\n  get proxyStatus() {\n    return proxyStatuses.ready;\n  }\n\n  get proxyReady() {\n    return this.proxyStatus === proxyStatuses.ready;\n  }\n\n  get proxyPending() {\n    return this.proxyStatus === proxyStatuses.pending;\n  }\n}\n"]}