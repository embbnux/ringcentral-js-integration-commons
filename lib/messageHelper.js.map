{"version":3,"sources":["lib/messageHelper.js"],"names":["filterNumbers","messageIsDeleted","messageIsTextMessage","messageIsFax","messageIsVoicemail","messageIsAcceptable","getMyNumberFromMessage","uniqueRecipients","getRecipientNumbersFromMessage","getRecipients","getNumbersFromMessage","sortByDate","sortSearchResults","numbers","filterNumber","filter","number","phoneNumber","extensionNumber","message","availability","type","fax","voiceMail","direction","myExtensionNumber","from","pager","myNumber","to","find","recipients","recipientMap","forEach","recipient","sms","allRecipients","concat","length","push","self","correspondents","entry","inbound","fromField","Array","isArray","toField","a","b","ta","Date","creationTime","getTime","tb","matchOrder"],"mappings":"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","file":"messageHelper.js","sourcesContent":["import messageTypes from '../enums/messageTypes';\n\nexport function filterNumbers(numbers, filterNumber) {\n  return numbers.filter((number) => {\n    if (filterNumber.phoneNumber) {\n      return filterNumber.phoneNumber !== number.phoneNumber;\n    }\n    return filterNumber.extensionNumber !== number.extensionNumber;\n  });\n}\n\nexport function messageIsDeleted(message) {\n  return message.availability === 'Deleted';\n}\n\nexport function messageIsTextMessage(message) {\n  return (message.type !== messageTypes.fax && message.type !== messageTypes.voiceMail);\n}\n\nexport function messageIsFax(message) {\n  return (message.type === messageTypes.fax);\n}\n\nexport function messageIsVoicemail(message) {\n  return (message.type === messageTypes.voiceMail);\n}\n\nexport function messageIsAcceptable(message) {\n  // do not show outbound faxes\n  // do not show deleted messages\n  return (message.type !== messageTypes.fax || message.direction === 'Inbound') &&\n    (!messageIsDeleted(message));\n}\n\nexport function getMyNumberFromMessage({ message, myExtensionNumber }) {\n  if (!message) {\n    return null;\n  }\n  if (message.direction === 'Outbound') {\n    return message.from;\n  }\n  if (message.type === messageTypes.pager) {\n    const myNumber = message.to.find(number => (\n      number.extensionNumber === myExtensionNumber\n    ));\n    if (myNumber) {\n      return myNumber;\n    }\n    return { extensionNumber: myExtensionNumber };\n  }\n  return message.to[0];\n}\n\nexport function uniqueRecipients(recipients) {\n  const recipientMap = {};\n  recipients.forEach((recipient) => {\n    recipientMap[JSON.stringify(recipient)] = recipient;\n  });\n  return Object.values(recipientMap);\n}\n\nexport function getRecipientNumbersFromMessage({ message, myNumber }) {\n  if (!message) {\n    return [];\n  }\n  if (message.type === messageTypes.sms) {\n    if (message.direction === 'Outbound') {\n      return message.to;\n    }\n    return [message.from];\n  }\n  const allRecipients = [message.from].concat(message.to);\n  const recipients = filterNumbers(allRecipients, myNumber);\n  if (recipients.length === 0) {\n    recipients.push(myNumber);\n  }\n  return uniqueRecipients(recipients);\n}\n\nexport function getRecipients({ message, myExtensionNumber }) {\n  const myNumber = getMyNumberFromMessage({\n    message,\n    myExtensionNumber,\n  });\n  return getRecipientNumbersFromMessage({\n    message,\n    myNumber,\n  });\n}\n\nexport function getNumbersFromMessage({ extensionNumber, message }) {\n  if (message.type === messageTypes.pager) {\n    return {\n      self: {\n        extensionNumber\n      },\n      correspondents: (\n        message.to &&\n        message.to.filter(entry => (\n          entry.extensionNumber !== extensionNumber\n        ))\n      ) || [],\n    };\n  }\n\n  const inbound = message.direction === 'Inbound';\n  const fromField = (\n    message.from &&\n      Array.isArray(message.from) ?\n      message.from :\n      [message.from]\n  ) || [];\n  const toField = (\n    message.to &&\n      Array.isArray(message.to) ?\n      message.to :\n      [message.to]\n  ) || [];\n  if (inbound) {\n    return {\n      self: toField[0],\n      correspondents: fromField,\n    };\n  }\n  return {\n    self: fromField[0],\n    correspondents: toField,\n  };\n}\n\nexport function sortByDate(a, b) {\n  const ta = new Date(a.creationTime).getTime();\n  const tb = new Date(b.creationTime).getTime();\n  if (ta === tb) return 0;\n  return ta > tb ? -1 : 1;\n}\n\nexport function sortSearchResults(a, b) {\n  if (a.matchOrder === b.matchOrder) return sortByDate(a, b);\n  return a.matchOrder > b.matchOrder ? 1 : -1;\n}\n"]}