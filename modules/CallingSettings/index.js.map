{"version":3,"sources":["modules/CallingSettings/index.js"],"names":["CallingSettings","alert","brand","extensionInfo","extensionPhoneNumber","forwardingNumber","storage","rolesAndPermissions","tabManager","onFirstLogin","addWebphone","options","actionTypes","_alert","_brand","_extensionInfo","_extensionPhoneNumber","_forwardingNumber","_storage","_rolesAndPermissions","_tabManager","_callWithStorageKey","_ringoutPromptStorageKey","_myLocationStorageKey","_timestampStorageKey","_fromNumberStorageKey","_onFirstLogin","registerReducer","key","reducer","_reducer","addSelector","directNumbers","mainCompanyNumber","extensionNumber","myPhoneNumbers","map","item","phoneNumber","push","flipNumbers","callerIdNumbers","filterMapping","forEach","filter","sort","a","b","label","phoneNumbers","firstItem","lastItem","usageType","ringoutEnabled","webphoneEnabled","otherPhoneNumbers","length","hasOtherPhone","callWithOptions","browser","softphone","myphone","otherphone","customphone","updateFromNumber","bind","store","subscribe","ready","status","pending","_myPhoneNumbers","_otherPhoneNumbers","_ringoutEnabled","_webphoneEnabled","dispatch","type","init","timestamp","defaultCallWith","setData","callWith","Date","now","warning","message","id","firstLogin","firstLoginOther","_validateSettings","_initFromNumber","initSuccess","resetSuccess","fromNumber","fromNumberList","fromNumbers","number","_setSoftPhoneToCallWith","danger","webphonePermissionRemoved","ttl","permissionChanged","indexOf","myLocation","phoneNumberChanged","withPrompt","ringoutPrompt","info","saveSuccessWithSoftphone","saveSuccess","state","getItem","_selectors","availableNumbers"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport getCallingSettingsReducer, {\n  getCallWithReducer,\n  getRingoutPromptReducer,\n  getMyLocationReducer,\n  getTimestampReducer,\n  getFromNumberReducer,\n} from './getCallingSettingsReducer';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport mapOptionToMode from './mapOptionToMode';\nimport callingOptions from './callingOptions';\nimport callingSettingsMessages from './callingSettingsMessages';\nimport actionTypes from './actionTypes';\n\nexport default class CallingSettings extends RcModule {\n  constructor({\n    alert,\n    brand,\n    extensionInfo,\n    extensionPhoneNumber,\n    forwardingNumber,\n    storage,\n    rolesAndPermissions,\n    tabManager,\n    onFirstLogin,\n    addWebphone,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._alert = alert;\n    this._brand = brand;\n    this._extensionInfo = extensionInfo;\n    this._extensionPhoneNumber = extensionPhoneNumber;\n    this._forwardingNumber = forwardingNumber;\n    this._storage = storage;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._tabManager = tabManager;\n\n    this._callWithStorageKey = 'callingSettingsCallWith';\n    this._ringoutPromptStorageKey = 'callingSettingsRingoutPrompt';\n    this._myLocationStorageKey = 'callingSettingsMyLocation';\n    this._timestampStorageKey = 'callingSettingsTimestamp';\n    this._fromNumberStorageKey = 'fromCallIdNumber';\n\n    this._onFirstLogin = onFirstLogin;\n\n    this._storage.registerReducer({\n      key: this._callWithStorageKey,\n      reducer: getCallWithReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._ringoutPromptStorageKey,\n      reducer: getRingoutPromptReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._myLocationStorageKey,\n      reducer: getMyLocationReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._timestampStorageKey,\n      reducer: getTimestampReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._fromNumberStorageKey,\n      reducer: getFromNumberReducer(this.actionTypes),\n    });\n    this._reducer = getCallingSettingsReducer(this.actionTypes);\n\n    this.addSelector('myPhoneNumbers',\n      () => this._extensionPhoneNumber.directNumbers,\n      () => this._extensionPhoneNumber.mainCompanyNumber,\n      () => this._extensionInfo.extensionNumber,\n      (directNumbers, mainCompanyNumber, extensionNumber) => {\n        const myPhoneNumbers = directNumbers.map(item => item.phoneNumber);\n        if (mainCompanyNumber && extensionNumber) {\n          myPhoneNumbers.push(`${mainCompanyNumber.phoneNumber}*${extensionNumber}`);\n        }\n        return myPhoneNumbers;\n      }\n    );\n\n    this.addSelector('otherPhoneNumbers',\n      () => this._forwardingNumber.flipNumbers,\n      () => this._extensionPhoneNumber.callerIdNumbers,\n      () => this._extensionPhoneNumber.directNumbers,\n      (flipNumbers, callerIdNumbers, directNumbers) => {\n        const filterMapping = {};\n        callerIdNumbers.forEach((item) => {\n          filterMapping[item.phoneNumber] = true;\n        });\n        directNumbers.forEach((item) => {\n          filterMapping[item.phoneNumber] = true;\n        });\n        return flipNumbers\n          .filter(item => !filterMapping[item.phoneNumber])\n          .sort((a, b) => (a.label === 'Mobile' && a.label !== b.label ? -1 : 1))\n          .map(item => item.phoneNumber);\n      }\n    );\n\n    this.addSelector(\n      'fromNumbers',\n      () => this._extensionPhoneNumber.callerIdNumbers,\n      phoneNumbers => phoneNumbers.sort((firstItem, lastItem) => {\n        if (firstItem.usageType === 'DirectNumber') return -1;\n        else if (lastItem.usageType === 'DirectNumber') return 1;\n        else if (firstItem.usageType === 'MainCompanyNumber') return -1;\n        else if (lastItem.usageType === 'MainCompanyNumber') return 1;\n        else if (firstItem.usageType < lastItem.usageType) return -1;\n        else if (firstItem.usageType > lastItem.usageType) return 1;\n        return 0;\n      }),\n    );\n\n    this.addSelector('callWithOptions',\n      () => this._rolesAndPermissions.ringoutEnabled,\n      () => this._rolesAndPermissions.webphoneEnabled,\n      () => this.otherPhoneNumbers.length > 0,\n      (ringoutEnabled, webphoneEnabled, hasOtherPhone) => {\n        const callWithOptions = [];\n        if (addWebphone && webphoneEnabled) {\n          callWithOptions.push(callingOptions.browser);\n        }\n        callWithOptions.push(callingOptions.softphone);\n        if (ringoutEnabled) {\n          callWithOptions.push(callingOptions.myphone);\n          if (hasOtherPhone) {\n            callWithOptions.push(callingOptions.otherphone);\n          }\n          callWithOptions.push(callingOptions.customphone);\n        }\n        return callWithOptions;\n      },\n    );\n    this.addSelector('availableNumbers',\n      () => this.myPhoneNumbers,\n      () => this.otherPhoneNumbers,\n      (myPhoneNumbers, otherPhoneNumbers) => ({\n        [callingOptions.myphone]: myPhoneNumbers,\n        [callingOptions.otherphone]: otherPhoneNumbers,\n      }),\n    );\n    this.updateFromNumber = this.updateFromNumber.bind(this);\n  }\n\n  initialize() {\n    this.store.subscribe(async () => {\n      if (\n        this._storage.ready &&\n        this._extensionInfo.ready &&\n        this._extensionPhoneNumber.ready &&\n        this._forwardingNumber.ready &&\n        this._rolesAndPermissions.ready &&\n        this.status === moduleStatuses.pending\n      ) {\n        this._myPhoneNumbers = this.myPhoneNumbers;\n        this._otherPhoneNumbers = this.otherPhoneNumbers;\n        this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n        this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n        this.store.dispatch({\n          type: this.actionTypes.init,\n        });\n        if (!this.timestamp) {\n          // first time login\n          const defaultCallWith = this.callWithOptions && this.callWithOptions[0];\n          this.store.dispatch({\n            type: this.actionTypes.setData,\n            callWith: defaultCallWith,\n            timestamp: Date.now(),\n          });\n          this._alert.warning({\n            message: this._brand.id === '1210' ?\n              callingSettingsMessages.firstLogin :\n              callingSettingsMessages.firstLoginOther,\n          });\n          if (typeof this._onFirstLogin === 'function') {\n            this._onFirstLogin();\n          }\n        }\n        this._validateSettings();\n        this._initFromNumber();\n        this.store.dispatch({\n          type: this.actionTypes.initSuccess,\n        });\n      } else if (\n        this.ready &&\n        (!this._storage.ready ||\n          !this._extensionInfo.ready ||\n          !this._extensionPhoneNumber.ready ||\n          !this._forwardingNumber.ready ||\n          !this._rolesAndPermissions.ready)\n      ) {\n        this.store.dispatch({\n          type: this.actionTypes.resetSuccess,\n        });\n      } else if (\n        this.ready &&\n        (this._ringoutEnabled !== this._rolesAndPermissions.ringoutEnabled ||\n          this._webphoneEnabled !== this._rolesAndPermissions.webphoneEnabled ||\n          this._myPhoneNumbers !== this.myPhoneNumbers ||\n          this._otherPhoneNumbers !== this.otherPhoneNumbers)\n      ) {\n        this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n        this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n        this._myPhoneNumbers = this.myPhoneNumbers;\n        this._otherPhoneNumbers = this.otherPhoneNumbers;\n        this._validateSettings();\n      }\n    });\n  }\n\n  _initFromNumber() {\n    const fromNumber = this.fromNumber;\n    if (!fromNumber) {\n      const fromNumberList = this.fromNumbers;\n      this.updateFromNumber(fromNumberList[0]);\n    }\n  }\n\n  updateFromNumber(number) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFromNumber,\n      number: number && number.phoneNumber,\n    });\n  }\n\n  _setSoftPhoneToCallWith() {\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith: callingOptions.softphone,\n      timestamp: Date.now(),\n    });\n  }\n\n  _validateSettings() {\n    if (\n      !this._webphoneEnabled &&\n      this.callWith === callingOptions.browser\n    ) {\n      this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.webphonePermissionRemoved,\n        ttl: 0,\n      });\n    } else if (\n      !this._ringoutEnabled &&\n      (\n        this.callWith === callingOptions.myphone ||\n        this.callWith === callingOptions.otherphone ||\n        this.callWith === callingOptions.customphone\n      )\n    ) {\n      this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.permissionChanged,\n        ttl: 0,\n      });\n    } else if (\n      (this.callWith === callingOptions.otherphone &&\n        this._otherPhoneNumbers.indexOf(this.myLocation) === -1) ||\n      (this.callWith === callingOptions.myphone &&\n        this._myPhoneNumbers.indexOf(this.myLocation) === -1)\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.setData,\n        callWith: callingOptions.myphone,\n        myLocation: this._myPhoneNumbers[0],\n        timestamp: Date.now(),\n      });\n      this._alert.danger({\n        message: callingSettingsMessages.phoneNumberChanged,\n        ttl: 0,\n      });\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  get callWith() {\n    return this._storage.getItem(this._callWithStorageKey);\n  }\n\n  get callingMode() {\n    return mapOptionToMode(this.callWith);\n  }\n\n  get callWithOptions() {\n    return this._selectors.callWithOptions();\n  }\n\n  get ringoutPrompt() {\n    return this._storage.getItem(this._ringoutPromptStorageKey);\n  }\n\n  get myLocation() {\n    return this._storage.getItem(this._myLocationStorageKey);\n  }\n\n  get timestamp() {\n    return this._storage.getItem(this._timestampStorageKey);\n  }\n\n  get myPhoneNumbers() {\n    return this._selectors.myPhoneNumbers();\n  }\n\n  get otherPhoneNumbers() {\n    return this._selectors.otherPhoneNumbers();\n  }\n\n  get availableNumbers() {\n    return this._selectors.availableNumbers();\n  }\n\n  get fromNumber() {\n    return this._storage.getItem(this._fromNumberStorageKey);\n  }\n\n  get fromNumbers() {\n    return this._selectors.fromNumbers();\n  }\n\n  setData({ callWith, myLocation, ringoutPrompt }, withPrompt) {\n    // TODO validate myLocation\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      timestamp: Date.now(),\n    });\n    if (withPrompt) {\n      if (this.callWith === callingOptions.softphone) {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccessWithSoftphone,\n        });\n      } else {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccess,\n        });\n      }\n    }\n  }\n}\n"]}