{"version":3,"sources":["modules/CallingSettings/index.js"],"names":["CallingSettings","alert","brand","extensionInfo","extensionPhoneNumber","forwardingNumber","storage","rolesAndPermissions","tabManager","onFirstLogin","addWebphone","options","actionTypes","_alert","_brand","_extensionInfo","_extensionPhoneNumber","_forwardingNumber","_storage","_rolesAndPermissions","_tabManager","_callWithStorageKey","_ringoutPromptStorageKey","_myLocationStorageKey","_timestampStorageKey","_onFirstLogin","registerReducer","key","reducer","_reducer","addSelector","directNumbers","mainCompanyNumber","extensionNumber","myPhoneNumbers","map","item","phoneNumber","push","flipNumbers","callerIdNumbers","filterMapping","forEach","filter","sort","a","b","label","ringoutEnabled","webphoneEnabled","otherPhoneNumbers","length","hasOtherPhone","callWithOptions","browser","softphone","myphone","otherphone","customphone","store","subscribe","ready","status","pending","_myPhoneNumbers","_otherPhoneNumbers","_ringoutEnabled","_webphoneEnabled","dispatch","type","init","timestamp","defaultCallWith","setData","callWith","Date","now","warning","message","id","firstLogin","firstLoginOther","_validateSettings","initSuccess","resetSuccess","_setSoftPhoneToCallWith","danger","webphonePermissionRemoved","ttl","permissionChanged","indexOf","myLocation","phoneNumberChanged","withPrompt","ringoutPrompt","info","saveSuccessWithSoftphone","saveSuccess","state","getItem","_selectors","availableNumbers"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport getCallingSettingsReducer, {\n  getCallWithReducer,\n  getRingoutPromptReducer,\n  getMyLocationReducer,\n  getTimestampReducer,\n} from './getCallingSettingsReducer';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport mapOptionToMode from './mapOptionToMode';\nimport callingOptions from './callingOptions';\nimport callingSettingsMessages from './callingSettingsMessages';\nimport actionTypes from './actionTypes';\n\nexport default class CallingSettings extends RcModule {\n  constructor({\n    alert,\n    brand,\n    extensionInfo,\n    extensionPhoneNumber,\n    forwardingNumber,\n    storage,\n    rolesAndPermissions,\n    tabManager,\n    onFirstLogin,\n    addWebphone,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._alert = alert;\n    this._brand = brand;\n    this._extensionInfo = extensionInfo;\n    this._extensionPhoneNumber = extensionPhoneNumber;\n    this._forwardingNumber = forwardingNumber;\n    this._storage = storage;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._tabManager = tabManager;\n\n    this._callWithStorageKey = 'callingSettingsCallWith';\n    this._ringoutPromptStorageKey = 'callingSettingsRingoutPrompt';\n    this._myLocationStorageKey = 'callingSettingsMyLocation';\n    this._timestampStorageKey = 'callingSettingsTimestamp';\n\n    this._onFirstLogin = onFirstLogin;\n\n    this._storage.registerReducer({\n      key: this._callWithStorageKey,\n      reducer: getCallWithReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._ringoutPromptStorageKey,\n      reducer: getRingoutPromptReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._myLocationStorageKey,\n      reducer: getMyLocationReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._timestampStorageKey,\n      reducer: getTimestampReducer(this.actionTypes),\n    });\n    this._reducer = getCallingSettingsReducer(this.actionTypes);\n\n    this.addSelector('myPhoneNumbers',\n      () => this._extensionPhoneNumber.directNumbers,\n      () => this._extensionPhoneNumber.mainCompanyNumber,\n      () => this._extensionInfo.extensionNumber,\n      (directNumbers, mainCompanyNumber, extensionNumber) => {\n        const myPhoneNumbers = directNumbers.map(item => item.phoneNumber);\n        if (mainCompanyNumber && extensionNumber) {\n          myPhoneNumbers.push(`${mainCompanyNumber.phoneNumber}*${extensionNumber}`);\n        }\n        return myPhoneNumbers;\n      }\n    );\n\n    this.addSelector('otherPhoneNumbers',\n      () => this._forwardingNumber.flipNumbers,\n      () => this._extensionPhoneNumber.callerIdNumbers,\n      () => this._extensionPhoneNumber.directNumbers,\n      (flipNumbers, callerIdNumbers, directNumbers) => {\n        const filterMapping = {};\n        callerIdNumbers.forEach((item) => {\n          filterMapping[item.phoneNumber] = true;\n        });\n        directNumbers.forEach((item) => {\n          filterMapping[item.phoneNumber] = true;\n        });\n        return flipNumbers\n          .filter(item => !filterMapping[item.phoneNumber])\n          .sort((a, b) => (a.label === 'Mobile' && a.label !== b.label ? -1 : 1))\n          .map(item => item.phoneNumber);\n      }\n    );\n\n    this.addSelector('callWithOptions',\n      () => this._rolesAndPermissions.ringoutEnabled,\n      () => this._rolesAndPermissions.webphoneEnabled,\n      () => this.otherPhoneNumbers.length > 0,\n      (ringoutEnabled, webphoneEnabled, hasOtherPhone) => {\n        const callWithOptions = [];\n        if (addWebphone && webphoneEnabled) {\n          callWithOptions.push(callingOptions.browser);\n        }\n        callWithOptions.push(callingOptions.softphone);\n        if (ringoutEnabled) {\n          callWithOptions.push(callingOptions.myphone);\n          if (hasOtherPhone) {\n            callWithOptions.push(callingOptions.otherphone);\n          }\n          callWithOptions.push(callingOptions.customphone);\n        }\n        return callWithOptions;\n      },\n    );\n    this.addSelector('availableNumbers',\n      () => this.myPhoneNumbers,\n      () => this.otherPhoneNumbers,\n      (myPhoneNumbers, otherPhoneNumbers) => ({\n        [callingOptions.myphone]: myPhoneNumbers,\n        [callingOptions.otherphone]: otherPhoneNumbers,\n      }),\n    );\n  }\n\n  initialize() {\n    this.store.subscribe(async () => {\n      if (\n        this._storage.ready &&\n        this._extensionInfo.ready &&\n        this._extensionPhoneNumber.ready &&\n        this._forwardingNumber.ready &&\n        this._rolesAndPermissions.ready &&\n        this.status === moduleStatuses.pending\n      ) {\n        this._myPhoneNumbers = this.myPhoneNumbers;\n        this._otherPhoneNumbers = this.otherPhoneNumbers;\n        this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n        this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n        this.store.dispatch({\n          type: this.actionTypes.init,\n        });\n        if (!this.timestamp) {\n          // first time login\n          const defaultCallWith = this.callWithOptions && this.callWithOptions[0];\n          this.store.dispatch({\n            type: this.actionTypes.setData,\n            callWith: defaultCallWith,\n            timestamp: Date.now(),\n          });\n          this._alert.warning({\n            message: this._brand.id === '1210' ?\n              callingSettingsMessages.firstLogin :\n              callingSettingsMessages.firstLoginOther,\n          });\n          if (typeof this._onFirstLogin === 'function') {\n            this._onFirstLogin();\n          }\n        }\n        this._validateSettings();\n        this.store.dispatch({\n          type: this.actionTypes.initSuccess,\n        });\n      } else if (\n        this.ready &&\n        (!this._storage.ready ||\n          !this._extensionInfo.ready ||\n          !this._extensionPhoneNumber.ready ||\n          !this._forwardingNumber.ready ||\n          !this._rolesAndPermissions.ready)\n      ) {\n        this.store.dispatch({\n          type: this.actionTypes.resetSuccess,\n        });\n      } else if (\n        this.ready &&\n        (this._ringoutEnabled !== this._rolesAndPermissions.ringoutEnabled ||\n          this._webphoneEnabled !== this._rolesAndPermissions.webphoneEnabled ||\n          this._myPhoneNumbers !== this.myPhoneNumbers ||\n          this._otherPhoneNumbers !== this.otherPhoneNumbers)\n      ) {\n        this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n        this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n        this._myPhoneNumbers = this.myPhoneNumbers;\n        this._otherPhoneNumbers = this.otherPhoneNumbers;\n        this._validateSettings();\n      }\n    });\n  }\n\n  _setSoftPhoneToCallWith() {\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith: callingOptions.softphone,\n      timestamp: Date.now(),\n    });\n  }\n\n  _validateSettings() {\n    if (\n      !this._webphoneEnabled &&\n      this.callWith === callingOptions.browser\n    ) {\n      this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.webphonePermissionRemoved,\n        ttl: 0,\n      });\n    } else if (\n      !this._ringoutEnabled &&\n      (\n        this.callWith === callingOptions.myphone ||\n        this.callWith === callingOptions.otherphone ||\n        this.callWith === callingOptions.customphone\n      )\n    ) {\n      this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.permissionChanged,\n        ttl: 0,\n      });\n    } else if (\n      (this.callWith === callingOptions.otherphone &&\n        this._otherPhoneNumbers.indexOf(this.myLocation) === -1) ||\n      (this.callWith === callingOptions.myphone &&\n        this._myPhoneNumbers.indexOf(this.myLocation) === -1)\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.setData,\n        callWith: callingOptions.myphone,\n        myLocation: this._myPhoneNumbers[0],\n        timestamp: Date.now(),\n      });\n      this._alert.danger({\n        message: callingSettingsMessages.phoneNumberChanged,\n        ttl: 0,\n      });\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  get callWith() {\n    return this._storage.getItem(this._callWithStorageKey);\n  }\n\n  get callingMode() {\n    return mapOptionToMode(this.callWith);\n  }\n\n  get callWithOptions() {\n    return this._selectors.callWithOptions();\n  }\n\n  get ringoutPrompt() {\n    return this._storage.getItem(this._ringoutPromptStorageKey);\n  }\n\n  get myLocation() {\n    return this._storage.getItem(this._myLocationStorageKey);\n  }\n\n  get timestamp() {\n    return this._storage.getItem(this._timestampStorageKey);\n  }\n\n  get myPhoneNumbers() {\n    return this._selectors.myPhoneNumbers();\n  }\n\n  get otherPhoneNumbers() {\n    return this._selectors.otherPhoneNumbers();\n  }\n\n  get availableNumbers() {\n    return this._selectors.availableNumbers();\n  }\n\n  setData({ callWith, myLocation, ringoutPrompt }, withPrompt) {\n    // TODO validate myLocation\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      timestamp: Date.now(),\n    });\n    if (withPrompt) {\n      if (this.callWith === callingOptions.softphone) {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccessWithSoftphone,\n        });\n      } else {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccess,\n        });\n      }\n    }\n  }\n}\n"]}