{"version":3,"sources":["modules/CallingSettings/index.js"],"names":["CallingSettings","alert","brand","extensionInfo","extensionPhoneNumber","forwardingNumber","storage","rolesAndPermissions","tabManager","onFirstLogin","webphone","options","actionTypes","_alert","_brand","_extensionInfo","_extensionPhoneNumber","_forwardingNumber","_storage","_rolesAndPermissions","_tabManager","_webphone","_callWithStorageKey","_ringoutPromptStorageKey","_myLocationStorageKey","_timestampStorageKey","_fromNumberStorageKey","_onFirstLogin","registerReducer","key","reducer","_reducer","addSelector","directNumbers","mainCompanyNumber","extensionNumber","myPhoneNumbers","map","item","phoneNumber","push","flipNumbers","callerIdNumbers","filterMapping","forEach","filter","sort","a","b","label","phoneNumbers","firstItem","lastItem","usageType","ringoutEnabled","webphoneEnabled","otherPhoneNumbers","length","hasOtherPhone","callWithOptions","browser","softphone","myphone","otherphone","customphone","store","subscribe","ready","status","pending","_myPhoneNumbers","_otherPhoneNumbers","_ringoutEnabled","_webphoneEnabled","dispatch","type","init","timestamp","defaultCallWith","setData","callWith","Date","now","warning","message","id","firstLogin","firstLoginOther","_validateSettings","_initFromNumber","initSuccess","resetSuccess","fromNumber","fromNumberList","fromNumbers","updateFromNumber","number","_setSoftPhoneToCallWith","danger","webphonePermissionRemoved","ttl","permissionChanged","indexOf","myLocation","phoneNumberChanged","info","emergencyCallingNotAvailable","withPrompt","ringoutPrompt","saveSuccessWithSoftphone","saveSuccess","_warningEmergencyCallingNotAvailable","state","getItem","_selectors","availableNumbers"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport getCallingSettingsReducer, {\n  getCallWithReducer,\n  getRingoutPromptReducer,\n  getMyLocationReducer,\n  getTimestampReducer,\n  getFromNumberReducer,\n} from './getCallingSettingsReducer';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport mapOptionToMode from './mapOptionToMode';\nimport callingOptions from './callingOptions';\nimport callingSettingsMessages from './callingSettingsMessages';\nimport actionTypes from './actionTypes';\nimport proxify from '../../lib/proxy/proxify';\n\nexport default class CallingSettings extends RcModule {\n  constructor({\n    alert,\n    brand,\n    extensionInfo,\n    extensionPhoneNumber,\n    forwardingNumber,\n    storage,\n    rolesAndPermissions,\n    tabManager,\n    onFirstLogin,\n    webphone,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._alert = alert;\n    this._brand = brand;\n    this._extensionInfo = extensionInfo;\n    this._extensionPhoneNumber = extensionPhoneNumber;\n    this._forwardingNumber = forwardingNumber;\n    this._storage = storage;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._tabManager = tabManager;\n    this._webphone = webphone;\n\n    this._callWithStorageKey = 'callingSettingsCallWith';\n    this._ringoutPromptStorageKey = 'callingSettingsRingoutPrompt';\n    this._myLocationStorageKey = 'callingSettingsMyLocation';\n    this._timestampStorageKey = 'callingSettingsTimestamp';\n    this._fromNumberStorageKey = 'fromCallIdNumber';\n\n    this._onFirstLogin = onFirstLogin;\n\n    this._storage.registerReducer({\n      key: this._callWithStorageKey,\n      reducer: getCallWithReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._ringoutPromptStorageKey,\n      reducer: getRingoutPromptReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._myLocationStorageKey,\n      reducer: getMyLocationReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._timestampStorageKey,\n      reducer: getTimestampReducer(this.actionTypes),\n    });\n    this._storage.registerReducer({\n      key: this._fromNumberStorageKey,\n      reducer: getFromNumberReducer(this.actionTypes),\n    });\n    this._reducer = getCallingSettingsReducer(this.actionTypes);\n\n    this.addSelector('myPhoneNumbers',\n      () => this._extensionPhoneNumber.directNumbers,\n      () => this._extensionPhoneNumber.mainCompanyNumber,\n      () => this._extensionInfo.extensionNumber,\n      (directNumbers, mainCompanyNumber, extensionNumber) => {\n        const myPhoneNumbers = directNumbers.map(item => item.phoneNumber);\n        if (mainCompanyNumber && extensionNumber) {\n          myPhoneNumbers.push(`${mainCompanyNumber.phoneNumber}*${extensionNumber}`);\n        }\n        return myPhoneNumbers;\n      }\n    );\n\n    this.addSelector('otherPhoneNumbers',\n      () => this._forwardingNumber.flipNumbers,\n      () => this._extensionPhoneNumber.callerIdNumbers,\n      () => this._extensionPhoneNumber.directNumbers,\n      (flipNumbers, callerIdNumbers, directNumbers) => {\n        const filterMapping = {};\n        callerIdNumbers.forEach((item) => {\n          filterMapping[item.phoneNumber] = true;\n        });\n        directNumbers.forEach((item) => {\n          filterMapping[item.phoneNumber] = true;\n        });\n        return flipNumbers\n          .filter(item => !filterMapping[item.phoneNumber])\n          .sort((a, b) => (a.label === 'Mobile' && a.label !== b.label ? -1 : 1))\n          .map(item => item.phoneNumber);\n      }\n    );\n\n    this.addSelector(\n      'fromNumbers',\n      () => this._extensionPhoneNumber.callerIdNumbers,\n      phoneNumbers => phoneNumbers.sort((firstItem, lastItem) => {\n        if (firstItem.usageType === 'DirectNumber') return -1;\n        else if (lastItem.usageType === 'DirectNumber') return 1;\n        else if (firstItem.usageType === 'MainCompanyNumber') return -1;\n        else if (lastItem.usageType === 'MainCompanyNumber') return 1;\n        else if (firstItem.usageType < lastItem.usageType) return -1;\n        else if (firstItem.usageType > lastItem.usageType) return 1;\n        return 0;\n      }),\n    );\n\n    this.addSelector('callWithOptions',\n      () => this._rolesAndPermissions.ringoutEnabled,\n      () => this._rolesAndPermissions.webphoneEnabled,\n      () => this.otherPhoneNumbers.length > 0,\n      (ringoutEnabled, webphoneEnabled, hasOtherPhone) => {\n        const callWithOptions = [];\n        if (this._webphone && webphoneEnabled) {\n          callWithOptions.push(callingOptions.browser);\n        }\n        callWithOptions.push(callingOptions.softphone);\n        if (ringoutEnabled) {\n          callWithOptions.push(callingOptions.myphone);\n          if (hasOtherPhone) {\n            callWithOptions.push(callingOptions.otherphone);\n          }\n          callWithOptions.push(callingOptions.customphone);\n        }\n        return callWithOptions;\n      },\n    );\n    this.addSelector('availableNumbers',\n      () => this.myPhoneNumbers,\n      () => this.otherPhoneNumbers,\n      (myPhoneNumbers, otherPhoneNumbers) => ({\n        [callingOptions.myphone]: myPhoneNumbers,\n        [callingOptions.otherphone]: otherPhoneNumbers,\n      }),\n    );\n  }\n\n  initialize() {\n    this.store.subscribe(async () => {\n      if (\n        this._storage.ready &&\n        this._extensionInfo.ready &&\n        this._extensionPhoneNumber.ready &&\n        this._forwardingNumber.ready &&\n        this._rolesAndPermissions.ready &&\n        this.status === moduleStatuses.pending\n      ) {\n        this._myPhoneNumbers = this.myPhoneNumbers;\n        this._otherPhoneNumbers = this.otherPhoneNumbers;\n        this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n        this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n        this.store.dispatch({\n          type: this.actionTypes.init,\n        });\n        if (!this.timestamp) {\n          // first time login\n          const defaultCallWith = this.callWithOptions && this.callWithOptions[0];\n          this.store.dispatch({\n            type: this.actionTypes.setData,\n            callWith: defaultCallWith,\n            timestamp: Date.now(),\n          });\n          this._alert.warning({\n            message: this._brand.id === '1210' ?\n              callingSettingsMessages.firstLogin :\n              callingSettingsMessages.firstLoginOther,\n          });\n          if (typeof this._onFirstLogin === 'function') {\n            this._onFirstLogin();\n          }\n        }\n        await this._validateSettings();\n        await this._initFromNumber();\n        this.store.dispatch({\n          type: this.actionTypes.initSuccess,\n        });\n      } else if (\n        this.ready &&\n        (!this._storage.ready ||\n          !this._extensionInfo.ready ||\n          !this._extensionPhoneNumber.ready ||\n          !this._forwardingNumber.ready ||\n          !this._rolesAndPermissions.ready)\n      ) {\n        this.store.dispatch({\n          type: this.actionTypes.resetSuccess,\n        });\n      } else if (\n        this.ready &&\n        (this._ringoutEnabled !== this._rolesAndPermissions.ringoutEnabled ||\n          this._webphoneEnabled !== this._rolesAndPermissions.webphoneEnabled ||\n          this._myPhoneNumbers !== this.myPhoneNumbers ||\n          this._otherPhoneNumbers !== this.otherPhoneNumbers)\n      ) {\n        this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n        this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n        this._myPhoneNumbers = this.myPhoneNumbers;\n        this._otherPhoneNumbers = this.otherPhoneNumbers;\n        await this._validateSettings();\n      }\n    });\n  }\n\n  @proxify\n  async _initFromNumber() {\n    const fromNumber = this.fromNumber;\n    if (!fromNumber) {\n      const fromNumberList = this.fromNumbers;\n      await this.updateFromNumber(fromNumberList[0]);\n    }\n  }\n\n  @proxify\n  async updateFromNumber(number) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFromNumber,\n      number: number && number.phoneNumber,\n    });\n  }\n\n  @proxify\n  async _setSoftPhoneToCallWith() {\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith: callingOptions.softphone,\n      timestamp: Date.now(),\n    });\n  }\n\n  @proxify\n  async _validateSettings() {\n    if (\n      !(\n        this._webphoneEnabled &&\n        this._webphone\n      ) &&\n      this.callWith === callingOptions.browser\n    ) {\n      await this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.webphonePermissionRemoved,\n        ttl: 0,\n      });\n    } else if (\n      !this._ringoutEnabled &&\n      (\n        this.callWith === callingOptions.myphone ||\n        this.callWith === callingOptions.otherphone ||\n        this.callWith === callingOptions.customphone\n      )\n    ) {\n      await this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.permissionChanged,\n        ttl: 0,\n      });\n    } else if (\n      (this.callWith === callingOptions.otherphone &&\n        this._otherPhoneNumbers.indexOf(this.myLocation) === -1) ||\n      (this.callWith === callingOptions.myphone &&\n        this._myPhoneNumbers.indexOf(this.myLocation) === -1)\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.setData,\n        callWith: callingOptions.myphone,\n        myLocation: this._myPhoneNumbers[0],\n        timestamp: Date.now(),\n      });\n      this._alert.danger({\n        message: callingSettingsMessages.phoneNumberChanged,\n        ttl: 0,\n      });\n    }\n  }\n  @proxify\n  async _warningEmergencyCallingNotAvailable() {\n    if (this.callWith === callingOptions.browser) {\n      this._alert.info({\n        message: callingSettingsMessages.emergencyCallingNotAvailable,\n      });\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  get callWith() {\n    return this._storage.getItem(this._callWithStorageKey);\n  }\n\n  get callingMode() {\n    return mapOptionToMode(this.callWith);\n  }\n\n  get callWithOptions() {\n    return this._selectors.callWithOptions();\n  }\n\n  get ringoutPrompt() {\n    return this._storage.getItem(this._ringoutPromptStorageKey);\n  }\n\n  get myLocation() {\n    return this._storage.getItem(this._myLocationStorageKey);\n  }\n\n  get timestamp() {\n    return this._storage.getItem(this._timestampStorageKey);\n  }\n\n  get myPhoneNumbers() {\n    return this._selectors.myPhoneNumbers();\n  }\n\n  get otherPhoneNumbers() {\n    return this._selectors.otherPhoneNumbers();\n  }\n\n  get availableNumbers() {\n    return this._selectors.availableNumbers();\n  }\n\n  get fromNumber() {\n    return this._storage.getItem(this._fromNumberStorageKey);\n  }\n\n  get fromNumbers() {\n    return this._selectors.fromNumbers();\n  }\n\n  @proxify\n  async setData({ callWith, myLocation, ringoutPrompt }, withPrompt) {\n    // TODO validate myLocation\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      timestamp: Date.now(),\n    });\n    if (withPrompt) {\n      if (this.callWith === callingOptions.softphone) {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccessWithSoftphone,\n        });\n      } else {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccess,\n        });\n        this._warningEmergencyCallingNotAvailable();\n      }\n    }\n  }\n}\n"]}