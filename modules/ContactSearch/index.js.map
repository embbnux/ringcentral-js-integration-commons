{"version":3,"sources":["modules/ContactSearch/index.js"],"names":["uniqueContactItems","sortContactItemsByName","groupByFirstLetterOfName","AllContactSourceName","DefaultMinimalSearchLength","DefaultContactListPageSize","result","items","filter","value","index","arr","indexOf","hash","unique","forEach","item","itemId","type","id","push","sort","a","b","name1","name","toLowerCase","replace","name2","isNumber1","test","isNumber2","localeCompare","contactItems","groups","length","group","contact","letter","toLocaleUpperCase","caption","contacts","ContactSearch","auth","storage","storageKey","minimalSearchLength","contactListPageSize","ttl","options","actionTypes","_auth","_storage","_storageKey","_minimalSearchLength","_contactListPageSize","_ttl","_searchSources","_searchSourcesFormat","_searchSourcesCheck","_reducer","registerReducer","key","reducer","cache","addSelector","size","names","keys","sourceName","searching","pageSize","pageNumber","searchCriteria","count","slice","store","subscribe","_onStateChange","_shouldInit","_initModuleStatus","_shouldReset","_resetModuleStatus","_clearStateCache","_restSearchCriteria","loginStatus","loggedIn","ready","_readyCheck","dispatch","initSuccess","cleanUp","restSearchCriteria","resetSuccess","reset","searchFn","readyCheckFn","formatFn","Error","has","set","searchString","prepareSearch","searchOnSources","_searchSource","updateSearchCriteria","source","search","entities","_searchFromCache","_loadSearching","get","_saveSearching","_onSearchError","list","current","next","currentName","currentPhoneNumber","phoneNumber","nextName","nextPhoneNumber","isSort","contactSearch","now","Date","timestamp","searchError","searchSuccess","save","getItem","state","status","searchStatus","_selectors","contactSourceNames","contactGroups","_quickSort"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport loginStatus from '../../modules/Auth/loginStatus';\nimport proxify from '../../lib/proxy/proxify';\n\nimport actionTypes from './actionTypes';\nimport getContactSearchReducer from './getContactSearchReducer';\nimport getCacheReducer from './getCacheReducer';\n\nexport const AllContactSourceName = 'all';\nexport const DefaultMinimalSearchLength = 3;\nexport const DefaultContactListPageSize = 20;\n\nexport function uniqueContactItems(result) {\n  let items = result || [];\n  // remove duplicated referencing\n  items = items.filter((value, index, arr) =>\n    arr.indexOf(value) === index\n  );\n  // remove duplicated items by id\n  const hash = {};\n  const unique = [];\n  items.forEach((item) => {\n    const itemId = `${item.type}${item.id}`;\n    if (!hash[itemId]) {\n      hash[itemId] = 1;\n      unique.push(item);\n    }\n  });\n  return unique;\n}\n\nexport function sortContactItemsByName(result) {\n  const items = result || [];\n  items.sort((a, b) => {\n    const name1 = (a.name || '').toLowerCase().replace(/^\\s\\s*/, ''); // trim start\n    const name2 = (b.name || '').toLowerCase().replace(/^\\s\\s*/, ''); // trim start\n    const isNumber1 = /^[0-9]/.test(name1);\n    const isNumber2 = /^[0-9]/.test(name2);\n    if (isNumber1 && isNumber2) {\n      return name1.localeCompare(name2);\n    } else if (isNumber1 || isNumber2) {\n      // put number name at last\n      return -name1.localeCompare(name2);\n    }\n    return name1.localeCompare(name2);\n  });\n  return items;\n}\n\nexport function groupByFirstLetterOfName(contactItems) {\n  const groups = [];\n  if (contactItems && contactItems.length) {\n    let group;\n    contactItems.forEach((contact) => {\n      const name = (contact.name || '').replace(/^\\s\\s*/, ''); // trim start\n      const letter = (name[0] || '').toLocaleUpperCase();\n      if (!group || group.caption !== letter) {\n        group = {\n          contacts: [],\n          caption: letter,\n          id: letter,\n        };\n        groups.push(group);\n      }\n      group.contacts.push(contact);\n    });\n  }\n  return groups;\n}\n\n/**\n * @class\n * @description Contact search module\n */\nexport default class ContactSearch extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Auth} params.auth - auth module instance\n   * @param {Storage} params.storage - storage module instance\n   * @param {String} params.storageKey - storage key for storage module default \"contactSearchCache\"\n   * @param {Number} params.minimalSearchLength - minimal search text length, default 3 characters\n   * @param {Number} params.ttl - timestamp of local cache, default 5 mins\n   */\n  constructor({\n    auth,\n    storage,\n    storageKey = 'contactSearchCache',\n    minimalSearchLength = DefaultMinimalSearchLength,\n    contactListPageSize = DefaultContactListPageSize,\n    ttl = 5 * 60 * 1000, // 5 minutes\n    ...options,\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = auth;\n    this._storage = storage;\n    this._storageKey = storageKey;\n    this._minimalSearchLength = minimalSearchLength;\n    this._contactListPageSize = contactListPageSize;\n    this._ttl = ttl;\n    this._searchSources = new Map();\n    this._searchSourcesFormat = new Map();\n    this._searchSourcesCheck = new Map();\n    if (this._storage) {\n      this._reducer = getContactSearchReducer(this.actionTypes);\n      this._storage.registerReducer({\n        key: this._storageKey,\n        reducer: getCacheReducer(this.actionTypes)\n      });\n    } else {\n      this._reducer = getContactSearchReducer(this.actionTypes, {\n        cache: getCacheReducer(this.actionTypes),\n      });\n    }\n\n    this.addSelector(\n      'contactSourceNames',\n      () => this._searchSources.size,\n      () => {\n        const names = [AllContactSourceName];\n        for (const sourceName of this._searchSources.keys()) {\n          names.push(sourceName);\n        }\n        return names;\n      }\n    );\n\n    this.addSelector(\n      'contactGroups',\n      () => this.searching && this.searching.result,\n      (result) => {\n        const pageSize = this._contactListPageSize;\n        const pageNumber = this.searchCriteria.pageNumber || 1;\n        const count = pageNumber * pageSize;\n        let items = uniqueContactItems(result);\n        items = sortContactItemsByName(items);\n        items = items.slice(0, count);\n        const groups = groupByFirstLetterOfName(items);\n        return groups;\n      }\n    );\n  }\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._initModuleStatus();\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n      this._clearStateCache();\n      this._restSearchCriteria();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loginStatus === loginStatus.loggedIn &&\n      (!this._storage || this._storage.ready) &&\n      this._readyCheck() &&\n      !this.ready\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (\n        this._auth.loginStatus !== loginStatus.loggedIn ||\n        (this._storage && !this._storage.ready)\n      ) &&\n      this.ready\n    );\n  }\n\n  _initModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  _clearStateCache() {\n    this.store.dispatch({\n      type: this.actionTypes.cleanUp,\n    });\n  }\n\n  _restSearchCriteria() {\n    this.store.dispatch({\n      type: this.actionTypes.restSearchCriteria,\n    });\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  resetSearchStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.reset,\n    });\n  }\n\n  addSearchSource({ sourceName, searchFn, readyCheckFn, formatFn }) {\n    if (!sourceName) {\n      throw new Error('ContactSearch: \"sourceName\" is required.');\n    }\n    if (this._searchSources.has(sourceName)) {\n      throw new Error(`ContactSearch: A search source named \"${sourceName}\" already exists`);\n    }\n    if (this._searchSourcesCheck.has(sourceName)) {\n      throw new Error(`ContactSearch: A search source check named \"${sourceName}\" already exists`);\n    }\n    if (this._searchSourcesFormat.has(sourceName)) {\n      throw new Error(`ContactSearch: A search source format named \"${sourceName}\" already exists`);\n    }\n    if (typeof searchFn !== 'function') {\n      throw new Error('ContactSearch: searchFn must be a function');\n    }\n    if (typeof readyCheckFn !== 'function') {\n      throw new Error('ContactSearch: readyCheckFn must be a function');\n    }\n    if (typeof formatFn !== 'function') {\n      throw new Error('ContactSearch: formatFn must be a function');\n    }\n    this._searchSources.set(sourceName, searchFn);\n    this._searchSourcesFormat.set(sourceName, formatFn);\n    this._searchSourcesCheck.set(sourceName, readyCheckFn);\n  }\n\n  @proxify\n  async search({ searchString }) {\n    if (!this.ready || (searchString.length < this._minimalSearchLength)) {\n      this.store.dispatch({\n        type: this.actionTypes.prepareSearch,\n      });\n      return;\n    }\n\n    const searchOnSources = Array.from(this._searchSources.keys());\n    for (const sourceName of searchOnSources) {\n      await this._searchSource({\n        searchOnSources,\n        sourceName,\n        searchString,\n      });\n    }\n  }\n\n  @proxify\n  async searchPlus({ sourceName, searchString, pageNumber }) {\n    if (!this.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.prepareSearch,\n      });\n      return;\n    }\n\n    this.store.dispatch({\n      type: this.actionTypes.updateSearchCriteria,\n      sourceName,\n      searchString,\n      pageNumber,\n    });\n\n    const searchOnSources = (!sourceName || sourceName === AllContactSourceName) ?\n      Array.from(this._searchSources.keys()) :\n      [sourceName];\n\n    for (const source of searchOnSources) {\n      await this._searchSource({\n        searchOnSources,\n        sourceName: source,\n        searchString,\n      });\n    }\n  }\n  // TODO Need to refactor, remove cache, and update data in real time.\n  @proxify\n  async _searchSource({ searchOnSources, sourceName, searchString }) {\n    this.store.dispatch({\n      type: this.actionTypes.search,\n    });\n    try {\n      let entities = null;\n      entities = this._searchFromCache({ sourceName, searchString });\n      if (entities) {\n        this._loadSearching({ searchOnSources, searchString, entities });\n        return;\n      }\n      entities = await this._searchSources.get(sourceName)({\n        searchString,\n      });\n      entities = this._searchSourcesFormat.get(sourceName)(entities);\n      this._loadSearching({ searchOnSources, searchString, entities });\n      this._saveSearching({ sourceName, searchString, entities });\n    } catch (error) {\n      this._onSearchError();\n    }\n  }\n\n  _quickSort({ result = [], searchString = '' }) {\n    const list = [...result];\n    if (searchString === '') {\n      return list;\n    }\n    return list.sort((current, next) => {\n      const currentName = current.name || '';\n      const currentPhoneNumber = current.phoneNumber || '';\n      const nextName = next.name || '';\n      const nextPhoneNumber = next.phoneNumber || '';\n      const isSort = (\n        currentName.indexOf(searchString) < nextName.indexOf(searchString) ||\n        currentPhoneNumber.indexOf(searchString) < nextPhoneNumber.indexOf(searchString)\n      );\n      return isSort;\n    });\n  }\n\n  _searchFromCache({ sourceName, searchString }) {\n    const key = `${sourceName}-${searchString}`;\n    const searching = this.cache && this.cache.contactSearch && this.cache.contactSearch[key];\n    const now = Date.now();\n    if (searching && (now - searching.timestamp) < this._ttl) {\n      return searching.entities;\n    }\n    return null;\n  }\n\n  _readyCheck() {\n    for (const sourceName of this._searchSourcesCheck.keys()) {\n      if (!this._searchSourcesCheck.get(sourceName)()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  _onSearchError() {\n    this.store.dispatch({\n      type: this.actionTypes.searchError,\n    });\n  }\n\n  _loadSearching({ searchOnSources, searchString, entities }) {\n    this.store.dispatch({\n      type: this.actionTypes.searchSuccess,\n      searchOnSources,\n      searchString,\n      entities,\n    });\n  }\n\n  _saveSearching({ sourceName, searchString, entities }) {\n    this.store.dispatch({\n      type: this.actionTypes.save,\n      sourceName,\n      searchString,\n      entities,\n      ttl: this._ttl,\n    });\n  }\n\n  get cache() {\n    return this._storage ?\n      this._storage.getItem(this._storageKey) :\n      this.state.cache;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get searchStatus() {\n    return this.state.searchStatus;\n  }\n\n  get searching() {\n    return this.state.searching;\n  }\n\n  get searchResult() {\n    return this.searching ? this.searching.result : [];\n  }\n\n  get searchCriteria() {\n    return this.state.searchCriteria;\n  }\n\n  get contactSourceNames() {\n    return this._selectors.contactSourceNames();\n  }\n\n  get contactGroups() {\n    return this._selectors.contactGroups();\n  }\n\n  get sortedResult() {\n    return this._quickSort(this.searching);\n  }\n}\n"]}