{"version":3,"sources":["modules/Call/index.js"],"names":["Call","alert","client","storage","callingSettings","softphone","ringout","webphone","extensionPhoneNumber","numberValidate","regionSettings","options","actionTypes","onCall","callStatus","idle","toNumber","trim","length","lastCallNumber","onToNumberChange","_alert","warning","message","noToNumber","store","dispatch","type","connect","number","_getValidatedNumbers","validatedNumbers","_makeCall","connectSuccess","connectError","firstLegConnectFailed","connectFailed","payroll","danger","networkError","internalError","_client","_storage","_storageKey","_fromNumberStorageKey","_reducer","_callingSettings","_ringout","_softphone","_webphone","_numberValidate","_extensionPhoneNumber","_regionSettings","_callSettingMode","registerReducer","key","reducer","addSelector","callerIdNumbers","phoneNumbers","sort","firstItem","lastItem","usageType","subscribe","ready","status","pending","init","_initFromNumber","callingMode","fromNumbers","initSuccess","resetSuccess","disconnect","oldCallSettingMode","fromNumber","fromNumberList","updateFromNumber","phoneNumber","value","toNumberChanged","data","isWebphone","myLocation","waitingValidateNumbers","push","validateNumbers","validatedResult","result","errors","forEach","error","parsedNumbers","numbers","parsedFromNumber","e164","subAddress","join","countryCode","homeCountry","availableCountries","find","country","isoCode","homeCountryId","callingCode","makeCall","prompt","ringoutPrompt","state","getItem","_selectors"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport callingModes from '../CallingSettings/callingModes';\nimport moduleStatuses from '../../enums/moduleStatuses';\n\nimport callActionTypes from './actionTypes';\nimport getCallReducer, {\n  getLastCallNumberReducer,\n  getFromNumberReducer,\n} from './getCallReducer';\n\nimport callStatus from './callStatus';\nimport callErrors from './callErrors';\nimport ringoutErrors from '../Ringout/ringoutErrors';\n\n\nexport default class Call extends RcModule {\n  constructor({\n    alert,\n    client,\n    storage,\n    callingSettings,\n    softphone,\n    ringout,\n    webphone,\n    extensionPhoneNumber,\n    numberValidate,\n    regionSettings,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: callActionTypes,\n    });\n\n    this._alert = alert;\n    this._client = client;\n    this._storage = storage;\n    this._storageKey = 'lastCallNumber';\n    this._fromNumberStorageKey = 'fromCallIdNumber';\n    this._reducer = getCallReducer(this.actionTypes);\n    this._callingSettings = callingSettings;\n    this._ringout = ringout;\n    this._softphone = softphone;\n    this._webphone = webphone;\n    this._numberValidate = numberValidate;\n    this._extensionPhoneNumber = extensionPhoneNumber;\n    this._regionSettings = regionSettings;\n    this._callSettingMode = null;\n\n    this._storage.registerReducer({\n      key: this._storageKey,\n      reducer: getLastCallNumberReducer(this.actionTypes),\n    });\n\n    this._storage.registerReducer({\n      key: this._fromNumberStorageKey,\n      reducer: getFromNumberReducer(this.actionTypes),\n    });\n\n    this.addSelector(\n      'fromNumbers',\n      () => this._extensionPhoneNumber.callerIdNumbers,\n      phoneNumbers => phoneNumbers.sort((firstItem, lastItem) => {\n        if (firstItem.usageType === 'DirectNumber') return -1;\n        else if (lastItem.usageType === 'DirectNumber') return 1;\n        else if (firstItem.usageType === 'MainCompanyNumber') return -1;\n        else if (lastItem.usageType === 'MainCompanyNumber') return 1;\n        else if (firstItem.usageType < lastItem.usageType) return -1;\n        else if (firstItem.usageType > lastItem.usageType) return 1;\n        return 0;\n      }),\n    );\n  }\n\n  initialize() {\n    this.store.subscribe(async () => {\n      if (\n        this._numberValidate.ready &&\n        this._callingSettings.ready &&\n        this._storage.ready &&\n        this._extensionPhoneNumber.ready &&\n        this._regionSettings.ready &&\n        (!this._webphone || this._webphone.ready) &&\n        this._ringout.ready &&\n        this._softphone.ready &&\n        this.status === moduleStatuses.pending\n      ) {\n        this.store.dispatch({\n          type: this.actionTypes.init,\n        });\n        this._initFromNumber();\n        // init webphone\n        this._callSettingMode = this._callingSettings.callingMode;\n        if (this._callSettingMode === callingModes.webphone) {\n          await this._webphone.connect(this.fromNumbers.length > 0);\n        }\n        this.store.dispatch({\n          type: this.actionTypes.initSuccess,\n        });\n      } else if (\n        (\n          !this._numberValidate.ready ||\n          !this._callingSettings.ready ||\n          !this._extensionPhoneNumber.ready ||\n          !this._regionSettings.ready ||\n          (!!this._webphone && !this._webphone.ready) ||\n          !this._ringout.ready ||\n          !this._softphone.ready ||\n          !this._storage.ready\n        ) &&\n        this.ready\n      ) {\n        this.store.dispatch({\n          type: this.actionTypes.resetSuccess,\n        });\n        this._callSettingMode = this._callingSettings.callingMode;\n        if (this._callSettingMode === callingModes.webphone && this._webphone) {\n          await this._webphone.disconnect();\n        }\n      } else if (this.ready) {\n        const oldCallSettingMode = this._callSettingMode;\n        if (this._callingSettings.callingMode !== oldCallSettingMode && this._webphone) {\n          this._callSettingMode = this._callingSettings.callingMode;\n          if (oldCallSettingMode === callingModes.webphone) {\n            await this._webphone.disconnect();\n          } else if (this._callSettingMode === callingModes.webphone) {\n            await this._webphone.connect(this.fromNumbers);\n          }\n        }\n      }\n    });\n  }\n\n  _initFromNumber() {\n    const fromNumber = this.fromNumber;\n    if (!fromNumber) {\n      const fromNumberList = this.fromNumbers;\n      this.updateFromNumber(fromNumberList[0]);\n    }\n  }\n\n  updateFromNumber(number) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFromNumber,\n      number: number && number.phoneNumber,\n    });\n  }\n\n  onToNumberChange(value) {\n    this.store.dispatch({\n      type: this.actionTypes.toNumberChanged,\n      data: value,\n    });\n  }\n\n  onCall = async () => {\n    if (this.callStatus === callStatus.idle) {\n      // last number check\n      if (`${this.toNumber}`.trim().length === 0) {\n        if (this.lastCallNumber) {\n          this.onToNumberChange(this.lastCallNumber);\n        } else {\n          this._alert.warning({\n            message: callErrors.noToNumber,\n          });\n        }\n      } else {\n        this.store.dispatch({\n          type: this.actionTypes.connect,\n          number: this.toNumber,\n        });\n        try {\n          const validatedNumbers = await this._getValidatedNumbers();\n          if (validatedNumbers) {\n            await this._makeCall(validatedNumbers);\n            this.store.dispatch({\n              type: this.actionTypes.connectSuccess\n            });\n          } else {\n            this.store.dispatch({\n              type: this.actionTypes.connectError\n            });\n          }\n        } catch (error) {\n          if (error.message === ringoutErrors.firstLegConnectFailed) {\n            this._alert.warning({\n              message: callErrors.connectFailed,\n              payroll: error\n            });\n          } else if (error.message === 'Failed to fetch') {\n            this._alert.danger({\n              message: callErrors.networkError,\n              payroll: error,\n            });\n          } else if (error.message !== 'Refresh token has expired') {\n            this._alert.danger({\n              message: callErrors.internalError,\n              payroll: error,\n            });\n          }\n          this.store.dispatch({\n            type: this.actionTypes.connectError\n          });\n        }\n      }\n    }\n  }\n\n  async _getValidatedNumbers() {\n    let fromNumber;\n    const isWebphone = (this._callingSettings.callingMode === callingModes.webphone);\n    if (isWebphone) {\n      fromNumber = this.fromNumber;\n      if (fromNumber === null || fromNumber === '') {\n        return null;\n      }\n    } else {\n      fromNumber = this._callingSettings.myLocation;\n    }\n    const waitingValidateNumbers = [this.toNumber];\n    if (\n      fromNumber &&\n      fromNumber.length > 0 &&\n      !(isWebphone && fromNumber === 'anonymous')\n    ) {\n      waitingValidateNumbers.push(fromNumber);\n    }\n    const validatedResult\n      = await this._numberValidate.validateNumbers(waitingValidateNumbers);\n    if (!validatedResult.result) {\n      validatedResult.errors.forEach((error) => {\n        this._alert.warning({\n          message: callErrors[error.type]\n        });\n      });\n      return null;\n    }\n    const parsedNumbers = validatedResult.numbers;\n    // using e164 in response to call\n    let parsedFromNumber =\n      parsedNumbers[1] ? parsedNumbers[1].e164 : '';\n    // add ext back if any\n    if (parsedFromNumber !== '') {\n      parsedFromNumber = (parsedNumbers[1].subAddress) ?\n        [parsedNumbers[1].e164, parsedNumbers[1].subAddress].join('*') :\n        parsedNumbers[1].e164;\n    }\n    return {\n      toNumber: parsedNumbers[0].e164,\n      fromNumber: parsedFromNumber,\n    };\n  }\n\n  async _makeCall({ toNumber, fromNumber }) {\n    const callingMode = this._callingSettings.callingMode;\n    const countryCode = this._regionSettings.countryCode;\n    const homeCountry = this._regionSettings.availableCountries.find(\n      country => country.isoCode === countryCode\n    );\n    const homeCountryId = (homeCountry && homeCountry.callingCode) || '1';\n    switch (callingMode) {\n      case callingModes.softphone:\n        this._softphone.makeCall(toNumber);\n        break;\n      case callingModes.ringout:\n        await this._ringout.makeCall({\n          fromNumber,\n          toNumber,\n          prompt: this._callingSettings.ringoutPrompt,\n        });\n        break;\n      case callingModes.webphone:\n        if (this._webphone) {\n          await this._webphone.makeCall({\n            fromNumber,\n            toNumber,\n            homeCountryId,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  get callStatus() {\n    return this.state.callStatus;\n  }\n\n  get isIdle() {\n    return this.state.callStatus === callStatus.idle;\n  }\n\n  get lastCallNumber() {\n    return this._storage.getItem(this._storageKey) || '';\n  }\n\n  get toNumber() {\n    return this.state.toNumber;\n  }\n\n  get fromNumber() {\n    return this._storage.getItem(this._fromNumberStorageKey);\n  }\n\n  get fromNumbers() {\n    return this._selectors.fromNumbers();\n  }\n}\n"]}