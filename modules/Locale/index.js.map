{"version":3,"sources":["modules/Locale/index.js"],"names":["checkIntl","resolve","global","Intl","process","browser","require","ensure","Locale","defaultLocale","options","actionTypes","_reducer","types","setLocale","currentLocale","store","dispatch","type","initSuccess","locale","setup","state","status","ready"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AAIA;;;;AACA;;;;AACA;;;;;;AAEA;;AAGA;;;;;AAKA,SAASA,SAAT,GAAqB;AACnB,SAAO,sBAAY,UAACC,OAAD,EAAa;AAC9B,QAAI,CAACC,OAAOC,IAAZ,EAAkB;AAChB,UAAIC,QAAQC,OAAZ,EAAqB;AACnBC,gBAAQC,MAAR,CAAe,CACb,MADa,EAEb,2BAFa,EAGb,2BAHa,EAIb,2BAJa,CAAf,EAKG,UAACD,OAAD,EAAa;AACdA,kBAAQ,MAAR;AACAA,kBAAQ,2BAAR;AACAA,kBAAQ,2BAAR;AACAA,kBAAQ,2BAAR;;AAEAL;AACD,SAZD,EAYG,MAZH;AAaD,OAdD,MAcO;AACLK,gBAAQ,MAAR;AACAL;AACD;AACF,KAnBD,MAmBO;AACLA;AACD;AACF,GAvBM,CAAP;AAwBD;;IAEoBO,M;;;AACnB,oBAGQ;AAAA,mFAAJ,EAAI;;AAAA,kCAFNC,aAEM;AAAA,QAFNA,aAEM;AAAA,QADHC,OACG;AAAA;;AAAA,iKAEDA,OAFC;AAGJC;AAHI;;AAKN,UAAKC,QAAL,GAAgB,gCAAiB,EAAEH,4BAAF,EAAiBI,OAAO,MAAKF,WAA7B,EAAjB,CAAhB;AALM;AAMP;;;;iCACY;AAAA;;AACX,iEAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACOX,WADP;;AAAA;AAAA;AAAA,uBAEO,OAAKc,SAAL,CAAe,OAAKC,aAApB,CAFP;;AAAA;AAGC,uBAAKC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,OAAKP,WAAL,CAAiBQ;AADL,iBAApB;;AAHD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAD;AAOD;;AAED;;;;;;;;AAeA;;;;;;;;;+FAQgBC,M;;;;;;uBACR,eAAKN,SAAL,CAAeM,MAAf,C;;;AACN,wCAAcC,KAAd,CAAoB;AAClBD,0BAAQ,KAAKL,aAAL,kDAAwD,KAAKA;AADnD,iBAApB;AAGA,qBAAKC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,KAAKP,WAAL,CAAiBG,SADL;AAElBM;AAFkB,iBAApB;;;;;;;;;;;;;;;;;;wBAzBkB;AAClB,aAAO,KAAKE,KAAL,CAAWP,aAAlB;AACD;;;wBAEY;AACX,aAAO,KAAKO,KAAL,CAAWC,MAAlB;AACD;;;wBAEW;AACV,aAAO,KAAKD,KAAL,CAAWC,MAAX,KAAsB,yBAAeC,KAA5C;AACD;;;;;kBAlCkBhB,M","file":"index.js","sourcesContent":["import formatMessage from 'format-message';\nimport RcModule from '../../lib/RcModule';\n\nimport I18n, {\n  DEFAULT_LOCALE,\n  PSEUDO_LOCALE,\n} from '../../lib/I18n';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport actionTypes from './actionTypes';\nimport getLocaleReducer from './getLocaleReducer';\n\n/* eslint-disable global-require */\n\n\n/**\n *  @function\n *  @description Check if the current environement requires the Intl polyfill.\n *  @return {Promise}\n */\nfunction checkIntl() {\n  return new Promise((resolve) => {\n    if (!global.Intl) {\n      if (process.browser) {\n        require.ensure([\n          'intl',\n          'intl/locale-data/jsonp/en',\n          'intl/locale-data/jsonp/de',\n          'intl/locale-data/jsonp/fr',\n        ], (require) => {\n          require('intl');\n          require('intl/locale-data/jsonp/en');\n          require('intl/locale-data/jsonp/de');\n          require('intl/locale-data/jsonp/fr');\n\n          resolve();\n        }, 'intl');\n      } else {\n        require('intl');\n        resolve();\n      }\n    } else {\n      resolve();\n    }\n  });\n}\n\nexport default class Locale extends RcModule {\n  constructor({\n    defaultLocale = DEFAULT_LOCALE,\n    ...options\n  } = {}) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._reducer = getLocaleReducer({ defaultLocale, types: this.actionTypes });\n  }\n  initialize() {\n    (async () => {\n      await checkIntl();\n      await this.setLocale(this.currentLocale);\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    })();\n  }\n\n  /**\n   * @property {String} currentLocale\n   */\n  get currentLocale() {\n    return this.state.currentLocale;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  /**\n   *  @function\n   *  @description Sets the desired locale as the current locale. This will also\n   *    set all I18n instances to the same locale, as well as set formatMessage to use\n   *    the same locale.\n   *  @param {String} locale\n   *  @return {Promise}\n   */\n  async setLocale(locale) {\n    await I18n.setLocale(locale);\n    formatMessage.setup({\n      locale: this.currentLocale === PSEUDO_LOCALE ? DEFAULT_LOCALE : this.currentLocale,\n    });\n    this.store.dispatch({\n      type: this.actionTypes.setLocale,\n      locale,\n    });\n  }\n}\n"]}