{"version":3,"sources":["modules/Locale/index.js"],"names":["checkIntl","resolve","global","Intl","process","browser","require","ensure","Locale","defaultLocale","options","actionTypes","_reducer","types","_proxyReducer","setLocale","currentLocale","store","dispatch","type","initSuccess","proxyInit","_setLocale","state","syncProxyLocale","locale","proxyInitSuccess","subscribe","setup","proxyState","status"],"mappings":"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","file":"index.js","sourcesContent":["import formatMessage from 'format-message';\nimport RcModule from '../../lib/RcModule';\nimport proxify from '../../lib/proxy/proxify';\n\nimport I18n, {\n  DEFAULT_LOCALE,\n  PSEUDO_LOCALE,\n} from '../../lib/I18n';\nimport actionTypes from './actionTypes';\nimport getLocaleReducer from './getLocaleReducer';\nimport getProxyReducer from './getProxyReducer';\n\n/* eslint-disable global-require */\n\n\n/**\n *  @function\n *  @description Check if the current environement requires the Intl polyfill.\n *  @return {Promise}\n */\nfunction checkIntl() {\n  return new Promise((resolve) => {\n    if (!global.Intl) {\n      if (process.browser) {\n        require.ensure([\n          'intl',\n          'intl/locale-data/jsonp/en',\n          'intl/locale-data/jsonp/de',\n          'intl/locale-data/jsonp/fr',\n        ], (require) => {\n          require('intl');\n          require('intl/locale-data/jsonp/en');\n          require('intl/locale-data/jsonp/de');\n          require('intl/locale-data/jsonp/fr');\n\n          resolve();\n        }, 'intl');\n      } else {\n        require('intl');\n        resolve();\n      }\n    } else {\n      resolve();\n    }\n  });\n}\n\nexport default class Locale extends RcModule {\n  constructor({\n    defaultLocale = DEFAULT_LOCALE,\n    ...options\n  } = {}) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._reducer = getLocaleReducer({ defaultLocale, types: this.actionTypes });\n    this._proxyReducer = getProxyReducer({ defaultLocale, types: this.actionTypes });\n  }\n  async initialize() {\n    await checkIntl();\n    await this.setLocale(this.currentLocale);\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n  async initializeProxy() {\n    this.store.dispatch({\n      type: this.actionTypes.proxyInit,\n    });\n    await checkIntl();\n    await this._setLocale(this.state.currentLocale);\n    this.store.dispatch({\n      type: this.actionTypes.syncProxyLocale,\n      locale: this.state.currentLocale,\n    });\n    this.store.dispatch({\n      type: this.actionTypes.proxyInitSuccess,\n    });\n    this.store.subscribe(async () => {\n      if (this.state.currentLocale !== this.currentLocale) {\n        await this._setLocale(this.state.currentLocale);\n        this.store.dispatch({\n          type: this.actionTypes.syncProxyLocale,\n          locale: this.state.currentLocale,\n        });\n      }\n    });\n  }\n\n  /**\n   * @property {String} currentLocale\n   */\n  get currentLocale() {\n    return (this.proxyState && this.proxyState.currentLocale) || this.state.currentLocale;\n  }\n\n  get status() {\n    return (this.proxyState && this.proxyState.status) || this.state.status;\n  }\n\n  get proxyStatus() {\n    return this.proxyState.status;\n  }\n\n  async _setLocale(locale) {\n    await I18n.setLocale(locale);\n    formatMessage.setup({\n      locale: this.currentLocale === PSEUDO_LOCALE ? DEFAULT_LOCALE : this.currentLocale,\n    });\n  }\n\n  /**\n   *  @function\n   *  @description Sets the desired locale as the current locale. This will also\n   *    set all I18n instances to the same locale, as well as set formatMessage to use\n   *    the same locale.\n   *  @param {String} locale\n   *  @return {Promise}\n   */\n  @proxify\n  async setLocale(locale) {\n    this._setLocale(locale);\n    this.store.dispatch({\n      type: this.actionTypes.setLocale,\n      locale,\n    });\n  }\n}\n"]}