{"version":3,"sources":["modules/Subscription/index.js"],"names":["DEFAULT_TIME_TO_RETRY","Subscription","auth","client","storage","timeToRetry","connectivityMonitor","options","actionTypes","_auth","_client","_storage","_timeToRetry","_connectivityMonitor","_cacheStorageKey","_reducer","registerReducer","key","reducer","_resetPromise","_removePromise","_retryTimeoutId","_registerTimeoutId","store","subscribe","loginStatus","loggedIn","ready","status","pending","dispatch","type","initSuccess","_connectivity","connectivity","notLoggedIn","reset","_subscription","remove","_subscribe","addBeforeLogoutHandler","t","Date","now","service","createSubscription","cachedSubscription","setSubscription","error","on","events","notification","message","removeSuccess","removeError","renewSuccess","subscription","renewError","_retry","subscribeSuccess","subscribeError","_detectSleep","clearTimeout","setTimeout","setEventFilters","filters","register","_createSubscription","_register","oldFilters","addFilters","concat","length","removeFilters","fiters","_stopRetry","_remove","resetSuccess","_reset","state","subscriptionStatus","getItem"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport sleep from '../../lib/sleep';\nimport loginStatus from '../Auth/loginStatus';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport getSubscriptionReducer, {\n  getCachedSubscriptionReducer,\n} from './getSubscriptionReducer';\nimport actionTypes from './actionTypes';\nimport proxify from '../../lib/proxy/proxify';\n\nconst DEFAULT_TIME_TO_RETRY = 60 * 1000;\n\nexport default class Subscription extends RcModule {\n  constructor({\n    auth,\n    client,\n    storage,\n    timeToRetry = DEFAULT_TIME_TO_RETRY,\n    connectivityMonitor,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = auth;\n    this._client = client;\n    this._storage = storage;\n    this._timeToRetry = timeToRetry;\n    this._connectivityMonitor = connectivityMonitor;\n    this._cacheStorageKey = 'cachedSubscription';\n    this._reducer = getSubscriptionReducer(this.actionTypes);\n    this._storage.registerReducer({\n      key: this._cacheStorageKey,\n      reducer: getCachedSubscriptionReducer(this.actionTypes),\n    });\n\n    this._resetPromise = null;\n    this._removePromise = null;\n    this._retryTimeoutId = null;\n    this._registerTimeoutId = null;\n  }\n  initialize() {\n    this.store.subscribe(async () => {\n      if (\n        this._auth.loginStatus === loginStatus.loggedIn &&\n        this._storage.ready &&\n        (!this._connectivityMonitor || this._connectivityMonitor.ready) &&\n        this.status === moduleStatuses.pending\n      ) {\n        this.store.dispatch({\n          type: this.actionTypes.initSuccess,\n        });\n        if (this._connectivityMonitor) {\n          this._connectivity = this._connectivityMonitor.connectivity;\n        }\n      } else if (\n        (\n          this._auth.loginStatus === loginStatus.notLoggedIn ||\n          !this._storage.ready ||\n          (!!this._connectivityMonitor && !this._connectivityMonitor.ready)\n        ) &&\n        this.ready\n      ) {\n        this.reset();\n      } else if (\n        this.ready &&\n        this._connectivityMonitor &&\n        this._connectivityMonitor.ready &&\n        this._connectivity !== this._connectivityMonitor.connectivity\n      ) {\n        this._connectivity = this._connectivityMonitor.connectivity;\n        if (this._connectivity && this._subscription) {\n          await this.remove();\n          await this._subscribe();\n        }\n      }\n    });\n    this._auth.addBeforeLogoutHandler(async () => {\n      if (this.ready) {\n        await this.reset();\n      }\n    });\n  }\n\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  get filters() {\n    return this.state.filters;\n  }\n\n  get message() {\n    return this.state.message;\n  }\n\n  get subscriptionStatus() {\n    return this.state.subscriptionStatus;\n  }\n\n  get cachedSubscription() {\n    return this._storage.getItem(this._cacheStorageKey);\n  }\n\n  async _detectSleep() {\n    while (this._subscription) {\n      const t = Date.now();\n      await sleep(10000);\n      if (this.ready && this._subscribe && Date.now() - t > 20 * 1000) {\n        // a time lapse of 10 seconds is detected\n        await this.remove();\n        await this._subscribe();\n        break;\n      }\n    }\n  }\n\n  _createSubscription() {\n    this._subscription = this._client.service.createSubscription();\n    if (this.cachedSubscription) {\n      try {\n        this._subscription.setSubscription(this.cachedSubscription);\n      } catch (error) {\n        /* falls through */\n      }\n    }\n    this._subscription.on(this._subscription.events.notification, (message) => {\n      this.store.dispatch({\n        type: this.actionTypes.notification,\n        message,\n      });\n    });\n    this._subscription.on(this._subscription.events.removeSuccess, () => {\n      this.store.dispatch({\n        type: this.actionTypes.removeSuccess,\n      });\n    });\n    this._subscription.on(this._subscription.events.removeError, (error) => {\n      this.store.dispatch({\n        type: this.actionTypes.removeError,\n        error,\n      });\n    });\n    this._subscription.on(this._subscription.events.renewSuccess, () => {\n      this.store.dispatch({\n        type: this.actionTypes.renewSuccess,\n        subscription: this._subscription.subscription(),\n      });\n    });\n    this._subscription.on(this._subscription.events.renewError, (error) => {\n      if (this._subscription) {\n        this._subscription.reset();\n        this._subscription = null;\n      }\n      this.store.dispatch({\n        type: this.actionTypes.renewError,\n        error,\n      });\n      if (\n        this._auth.loginStatus === loginStatus.loggedIn &&\n        this._storage.ready\n      ) {\n        // immediately start the retry process after the first renewError\n        this._retry(0);\n      }\n    });\n    this._subscription.on(this._subscription.events.subscribeSuccess, () => {\n      this.store.dispatch({\n        type: this.actionTypes.subscribeSuccess,\n        subscription: this._subscription.subscription(),\n      });\n    });\n    this._subscription.on(this._subscription.events.subscribeError, (error) => {\n      this.store.dispatch({\n        type: this.actionTypes.subscribeError,\n        error,\n      });\n      if (\n        this._auth.loginStatus === loginStatus.loggedIn &&\n        this._storage.ready\n      ) {\n        this._retry();\n      }\n    });\n    this._detectSleep();\n  }\n\n  _register() {\n    if (this._registerTimeoutId) {\n      clearTimeout(this._registerTimeoutId);\n    }\n    this._registerTimeoutId = setTimeout(() => {\n      this._registerTimeoutId = null;\n      this.store.dispatch({\n        type: this.actionTypes.subscribe,\n      });\n      this._subscription.setEventFilters(this.filters);\n      this._subscription.register();\n    }, 2000);\n  }\n\n  _subscribe() {\n    if (!this._subscription) {\n      this._createSubscription();\n    }\n    this._subscription.setEventFilters(this.filters);\n    this._register();\n  }\n\n  @proxify\n  async subscribe(events = []) {\n    if (this.ready) {\n      const oldFilters = this.filters;\n      this.store.dispatch({\n        type: this.actionTypes.addFilters,\n        filters: [].concat(events),\n      });\n      if (oldFilters.length !== this.filters.length) {\n        await this._subscribe();\n      }\n    }\n  }\n\n  @proxify\n  async unsubscribe(events = []) {\n    if (this.ready) {\n      const oldFilters = this.filters;\n      this.store.dispatch({\n        type: this.actionTypes.removeFilters,\n        fiters: [].concat(events),\n      });\n      if (this.filters.length === 0) {\n        this.remove();\n      } else if (oldFilters.length !== this.filters.length) {\n        this._subscribe();\n      }\n    }\n  }\n\n  async _stopRetry() {\n    if (this._retryTimeoutId) {\n      clearTimeout(this._retryTimeoutId);\n      this._retryTimeoutId = null;\n    }\n  }\n\n  async _retry(t = this._timeToRetry) {\n    this._stopRetry();\n    this._retryTimeoutId = setTimeout(() => {\n      if (this.ready) {\n        this._subscribe();\n      }\n    }, t);\n  }\n\n  async _remove() {\n    if (this._subscription) {\n      try {\n        this.store.dispatch({\n          type: this.actionTypes.remove,\n        });\n        await this._subscription.remove();\n      } catch (error) {\n        /* falls through */\n      }\n      if (this._subscription) { // check again in case subscription object was removed while waiting\n        this._subscription.reset();\n        this._subscription = null;\n      }\n      this._removePromise = null;\n    }\n  }\n\n  @proxify\n  async remove() {\n    if (!this._removePromise) {\n      this._removePromise = this._remove();\n    }\n    return this._removePromise;\n  }\n\n  async _reset() {\n    this.store.dispatch({\n      type: this.actionTypes.reset,\n    });\n    this._stopRetry();\n    if (this._subscription) {\n      if (this._auth.loggedIn) {\n        try {\n          await this.remove();\n        } catch (error) {\n          /* falls through */\n        }\n      } else {\n        this._subscription.reset();\n        this._subscription = null;\n      }\n    }\n    this._resetPromise = null;\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  async reset() {\n    if (!this._resetPromise) {\n      this._resetPromise = this._reset();\n    }\n    return this._resetPromise;\n  }\n}\n"]}