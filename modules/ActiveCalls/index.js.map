{"version":3,"sources":["modules/ActiveCalls/index.js"],"names":["presenceRegExp","FETCH_DELAY","DEFAULT_TTL","ActiveCalls","client","tabManager","ttl","options","name","subscriptionFilters","detailedPresence","subscriptionHandler","message","test","event","ownerId","_auth","fetchData","fetchFunction","_client","account","extension","activeCalls","list","params","map","addSelector","data","_selectors","calls"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,iBAAiB,0CAAvB;AACA,IAAMC,cAAc,IAApB;AACA,IAAMC,cAAc,IAAI,EAAJ,GAAS,IAA7B;;IAEqBC,W;;;AACnB,6BAKG;AAAA;;AAAA,QAJDC,MAIC,QAJDA,MAIC;AAAA,QAHDC,UAGC,QAHDA,UAGC;AAAA,wBAFDC,GAEC;AAAA,QAFDA,GAEC,4BAFKJ,WAEL;AAAA,QADEK,OACF;AAAA;;AAAA,2KAEIA,OAFJ;AAGCC,YAAM,aAHP;AAICJ,oBAJD;AAKCE,cALD;AAMCG,2BAAqB,CAAC,kBAAoBC,gBAArB,CANtB;AAOCC;AAAA,+EAAqB,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACfZ,eAAea,IAAf,CAAoBD,QAAQE,KAA5B,CADe;AAAA;AAAA;AAAA;;AAEXC,yBAFW,GAED,MAAKC,KAAL,CAAWD,OAFV;AAAA;AAAA,yBAGX,qBAAMd,WAAN,CAHW;;AAAA;AAAA,wBAIbc,YAAY,MAAKC,KAAL,CAAWD,OAJV;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAKT,MAAKE,SAAL,EALS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAArB;;AAAA;AAAA;AAAA;AAAA,SAPD;AAgBCC;AAAA,+EAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAmB,yBAAU;AAAA,2BAC1C,MAAKC,OAAL,CAAaC,OAAb,GAAuBC,SAAvB,GAAmCC,WAAnC,GAAiDC,IAAjD,CAAsDC,MAAtD,CAD0C;AAAA,mBAAV,CAAnB;;AAAA;AAAA;AAAA,mEAEXC,GAFW;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAf;;AAAA;AAAA;AAAA;AAAA;AAhBD;;AAoBD,UAAKC,WAAL,CACE,OADF,EAEE;AAAA,aAAM,MAAKC,IAAX;AAAA,KAFF,EAGE;AAAA,aAAQA,QAAQ,EAAhB;AAAA,KAHF;AApBC;AAyBF;;;;wBAEW;AACV,aAAO,KAAKC,UAAL,CAAgBC,KAAhB,EAAP;AACD;;;;;kBAnCkB1B,W","file":"index.js","sourcesContent":["import DataFetcher from '../../lib/DataFetcher';\nimport sleep from '../../lib/sleep';\nimport fetchList from '../../lib/fetchList';\nimport subscriptionFilters from '../Subscription/filters';\nimport processCall from '../../lib/processCall';\n\nconst presenceRegExp = /\\/presence\\?detailedTelephonyState=true$/;\nconst FETCH_DELAY = 1000;\nconst DEFAULT_TTL = 5 * 60 * 1000;\n\nexport default class ActiveCalls extends DataFetcher {\n  constructor({\n    client,\n    tabManager, // do not pass tabManager to DataFetcher as data is not shared in localStorage\n    ttl = DEFAULT_TTL,\n    ...options\n  }) {\n    super({\n      ...options,\n      name: 'activeCalls',\n      client,\n      ttl,\n      subscriptionFilters: [subscriptionFilters.detailedPresence],\n      subscriptionHandler: async (message) => {\n        if (presenceRegExp.test(message.event)) {\n          const ownerId = this._auth.ownerId;\n          await sleep(FETCH_DELAY);\n          if (ownerId === this._auth.ownerId) {\n            await this.fetchData();\n          }\n        }\n      },\n      fetchFunction: async () => (await fetchList(params => (\n        this._client.account().extension().activeCalls().list(params)\n      ))).map(processCall),\n    });\n    this.addSelector(\n      'calls',\n      () => this.data,\n      data => data || [],\n    );\n  }\n\n  get calls() {\n    return this._selectors.calls();\n  }\n}\n"]}