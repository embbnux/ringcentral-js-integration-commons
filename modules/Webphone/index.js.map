{"version":3,"sources":["modules/Webphone/index.js"],"names":["Webphone","appKey","appName","appVersion","auth","client","rolesAndPermissions","webphoneLogLevel","storage","options","actionTypes","_appKey","_appName","_appVersion","_webphoneLogLevel","_auth","_client","_rolesAndPermissions","_storage","_storageKey","_webphone","_remoteVideo","_localVideo","_activeSession","_sessions","_reducer","_cacheReducer","registerReducer","key","reducer","window","document","createElement","setAttribute","body","appendChild","store","dispatch","type","init","videoElementPrepared","subscribe","_onStateChange","_shouldInit","initSuccess","_shouldReset","resetSuccess","ready","service","platform","post","sipInfo","transport","json","provisionData","uuid","endpoingId","logLevel","audioHelper","enabled","incoming","outgoing","onRegistered","registered","onUnregistered","unregistered","userAgent","removeAllListeners","onRegistrationFailed","error","registrationFailed","setVolume","on","once","session","console","log","_onInvite","checkIsLoggedIn","connectionStatus","disconnected","connect","_sipProvision","_createWebphone","connectError","connected","disconnect","stop","unregister","sessions","forEach","hangup","_removeSessions","response","cause","newSession","onAccepted","_addSession","_removeSession","isOnHold","local","hold","_onAccepted","accept","acceptOptions","reject","forwardNumber","forward","ua","volume","isOnMute","mute","unmute","unhold","sessionItem","sessionId","id","startRecord","isOnRecord","stopRecord","park","transferNumber","transfer","invite","media","warmTransfer","flipValue","flip","dtmfValue","dtmf","terminate","e","toNumber","fromNumber","homeCountryId","set","delete","state","status","webphoneEnabled","getItem","webphoneCounts","render","remote"],"mappings":"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","file":"index.js","sourcesContent":["import RingCentralWebphone from 'ringcentral-web-phone';\nimport incomingAudio from 'ringcentral-web-phone/audio/incoming.ogg';\nimport outgoingAudio from 'ringcentral-web-phone/audio/outgoing.ogg';\n\nimport RcModule from '../../lib/RcModule';\nimport moduleStatus from '../../enums/moduleStatus';\nimport connectionStatus from './connectionStatus';\nimport actionTypes from './actionTypes';\n\nimport getWebphoneReducer from './getWebphoneReducer';\nimport getCacheReducer from './getCacheReducer';\n\nexport default class Webphone extends RcModule {\n  constructor({\n    appKey,\n    appName,\n    appVersion,\n    auth,\n    client,\n    rolesAndPermissions,\n    webphoneLogLevel = 3,\n    storage,\n    ...options,\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._appKey = appKey;\n    this._appName = appName;\n    this._appVersion = appVersion;\n    this._webphoneLogLevel = webphoneLogLevel;\n    this._auth = auth;\n    this._client = client;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._storage = storage;\n    this._storageKey = 'webphone';\n    this._webphone = null;\n    this._remoteVideo = null;\n    this._localVideo = null;\n\n    this._activeSession = null;\n    this._sessions = new Map();\n\n    this._reducer = getWebphoneReducer(this.actionTypes);\n    this._cacheReducer = getCacheReducer(this.actionTypes);\n\n    storage.registerReducer({ key: this._storageKey, reducer: this._cacheReducer });\n  }\n\n  initialize() {\n    if (\n      typeof window !== 'undefined' &&\n      typeof document !== 'undefined'\n    ) {\n      this._remoteVideo = document.createElement('video');\n      this._remoteVideo.setAttribute('hidden', 'hidden');\n      this._localVideo = document.createElement('video');\n      this._localVideo.setAttribute('hidden', 'hidden');\n      this._localVideo.setAttribute('muted', 'muted');\n      document.body.appendChild(this._remoteVideo);\n      document.body.appendChild(this._localVideo);\n      this.store.dispatch({\n        type: this.actionTypes.init,\n        videoElementPrepared: true,\n      });\n    } else {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n        videoElementPrepared: false,\n      });\n    }\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.ready &&\n      this._rolesAndPermissions.ready &&\n      !this.ready\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (\n        !this._auth.ready ||\n        !this._rolesAndPermissions.ready\n      ) &&\n      this.ready\n    );\n  }\n\n  async _sipProvision() {\n    return (await this._client.service.platform()\n      .post('/client-info/sip-provision', {\n        sipInfo: [{ transport: 'WSS' }]\n      })).json();\n  }\n\n  _createWebphone(provisionData) {\n    this._webphone = new RingCentralWebphone(provisionData, {\n      appKey: this._appKey,\n      appName: this._appName,\n      appVersion: this._appVersion,\n      uuid: this._auth.endpoingId,\n      logLevel: this._webphoneLogLevel, // error 0, warn 1, log: 2, debug: 3\n      audioHelper: {\n        enabled: true, // enables audio feedback when web phone is ringing or making a call\n        incoming: incomingAudio, // path to audio file for incoming call\n        outgoing: outgoingAudio, // path to aduotfile for outgoing call\n      }\n    });\n\n    const onRegistered = () => {\n      this.store.dispatch({\n        type: this.actionTypes.registered,\n      });\n    };\n    const onUnregistered = () => {\n      this.store.dispatch({\n        type: this.actionTypes.unregistered,\n      });\n      this._webphone.userAgent.removeAllListeners();\n      this._webphone = null;\n    };\n    const onRegistrationFailed = (error) => {\n      this.store.dispatch({\n        type: this.actionTypes.registrationFailed,\n        error,\n      });\n    };\n    this._webphone.userAgent.audioHelper.setVolume(0.3);\n    this._webphone.userAgent.on('registered', onRegistered);\n    this._webphone.userAgent.on('unregistered', onUnregistered);\n    this._webphone.userAgent.once('registrationFailed', onRegistrationFailed);\n    this._webphone.userAgent.on('invite', (session) => {\n      console.log('UA invite');\n      this._onInvite(session);\n    });\n  }\n\n  async connect() {\n    if (\n      (await this._auth.checkIsLoggedIn()) &&\n      this.enabled &&\n      this.connectionStatus === connectionStatus.disconnected\n    ) {\n      try {\n        this.store.dispatch({\n          type: this.actionTypes.connect,\n        });\n        this._createWebphone(await this._sipProvision());\n      } catch (error) {\n        this.store.dispatch({\n          type: this.actionTypes.connectError,\n          error,\n        });\n      }\n    }\n  }\n\n  async disconnect() {\n    if (\n      this._webphone &&\n      this.connectionStatus === connectionStatus.connected\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.disconnect,\n      });\n      this._webphone.userAgent.stop();\n      this._webphone.userAgent.unregister();\n      this.sessions.forEach((session) => {\n        this.hangup(session);\n      });\n    }\n  }\n\n  _onAccepted(session) {\n    session.on('accepted', () => {\n      console.log('accepted');\n    });\n    session.on('progress', () => {\n      console.log('progress...');\n    });\n    session.on('rejected', () => {\n      console.log('rejected');\n      this._removeSessions(session);\n    });\n    session.on('failed', (response, cause) => {\n      console.log('Event: Failed');\n      console.log(cause);\n      this._removeSessions(session);\n    });\n    session.on('terminated', () => {\n      console.log('Event: Failed');\n      this._removeSessions(session);\n    });\n    session.on('cancel', () => {\n      console.log('Event: Cancel');\n      this._removeSessions(session);\n    });\n    session.on('refer', () => {\n      console.log('Event: Refer');\n    });\n    session.on('replaced', (newSession) => {\n      this.onAccepted(newSession);\n    });\n    session.on('muted', () => {\n      console.log('Event: Muted');\n    });\n    session.on('unmuted', () => {\n      console.log('Event: Unmuted');\n    });\n    session.on('hold', () => {\n      console.log('Event: hold');\n    });\n    session.on('unhold', () => {\n      console.log('Event: unhold');\n    });\n  }\n\n  _onInvite(session) {\n    this._addSession(session);\n    session.on('rejected', () => {\n      console.log('Event: Rejected');\n      this._removeSession(session);\n    });\n  }\n\n  async answer(session) {\n    try {\n      if (this._activeSession && !this._activeSession.isOnHold().local) {\n        this._activeSession.hold();\n      }\n      this._activeSession = session;\n      this._onAccepted(session, 'inbound');\n      await session.accept(this.acceptOptions);\n    } catch (e) {\n      console.log('Accept failed');\n      this._removeSession(session);\n    }\n  }\n\n  reject(session) {\n    session.reject();\n  }\n\n  async forward(forwardNumber, session) {\n    try {\n      await session.forward(forwardNumber, this.acceptOptions);\n      console.log('Forwarded');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  increaseVolume(session) {\n    session.ua.audioHelper.setVolume(\n      (session.ua.audioHelper.volume != null ? session.ua.audioHelper.volume : 0.5) + 0.1\n    );\n  }\n\n  decreaseVolume(session) {\n    session.ua.audioHelper.setVolume(\n      (session.ua.audioHelper.volume != null ? session.ua.audioHelper.volume : 0.5) - 0.1\n    );\n  }\n\n  mute(session) {\n    session.isOnMute = true;\n    session.mute();\n  }\n\n  unmute(session) {\n    session.isOnMute = false;\n    session.unmute();\n  }\n\n  hold(session) {\n    session.hold();\n  }\n\n  unhold(session) {\n    session.unhold();\n    this.sessions.forEach((sessionItem, sessionId) => {\n      if (session.id !== sessionId) {\n        if (!session.isOnHold().local) {\n          sessionItem.hold();\n        }\n      }\n    });\n  }\n\n  async startRecord(session) {\n    try {\n      await session.startRecord();\n      session.isOnRecord = true;\n      console.log('Recording Started');\n    } catch (e) {\n      session.isOnRecord = false;\n      console.error(e);\n    }\n  }\n\n  async stopRecord(session) {\n    try {\n      await session.stopRecord();\n      session.isOnRecord = false;\n      console.log('Recording Stopped');\n    } catch (e) {\n      session.isOnRecord = true;\n      console.error(e);\n    }\n  }\n\n  async park(session) {\n    try {\n      await session.park();\n      console.log('Parked');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async transfer(transferNumber, session) {\n    try {\n      await session.transfer(transferNumber);\n      console.log('Transferred');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async transferWarm(transferNumber, session) {\n    try {\n      await session.hold();\n      const newSession = session.ua.invite(transferNumber, {\n        media: this.acceptOptions.media\n      });\n      newSession.once('accepted', async () => {\n        try {\n          await session.warmTransfer(newSession);\n          console.log('Transferred');\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async flip(flipValue, session) {\n    try {\n      await session.flip(flipValue);\n      console.log('Flipped');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  sendDTMF(dtmfValue, session) {\n    session.dtmf(dtmfValue);\n  }\n\n  hangup(session) {\n    try {\n      session.terminate();\n    } catch (e) {\n      console.log(e);\n      this._removeSession(session);\n    }\n  }\n\n  makeCall(toNumber, fromNumber, homeCountryId) {\n    const session = this._webphone.userAgent.invite(toNumber, {\n      media: this.acceptOptions.media,\n      fromNumber,\n      homeCountryId,\n    });\n    this._onAccepted(session);\n    if (this._activeSession && !this._activeSession.isOnHold().local) {\n      this._activeSession.hold();\n    }\n    this._activeSession = session;\n    this._addSession(session);\n    return session;\n  }\n\n  _addSession(session) {\n    this._sessions.set(session.id, session);\n  }\n\n  _removeSession(session) {\n    this._sessions.delete(session.id);\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatus.ready;\n  }\n\n  get videoElementPrepared() {\n    return this.state.videoElementPrepared;\n  }\n\n  get enabled() {\n    return this.videoElementPrepared && this._rolesAndPermissions.webphoneEnabled;\n  }\n\n  get connectionStatus() {\n    return this.state.connectionStatus;\n  }\n\n  get webphoneCounts() {\n    return this._storage.getItem(this._storageKey).webphoneCounts;\n  }\n\n  get acceptOptions() {\n    return {\n      media: {\n        render: {\n          remote: this._remoteVideo,\n          local: this._localVideo,\n        }\n      }\n    };\n  }\n}\n"]}