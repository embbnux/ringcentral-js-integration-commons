{"version":3,"sources":["modules/Webphone/index.js"],"names":["FIRST_THREE_RETRIES_DELAY","FOURTH_RETRIES_DELAY","FIFTH_RETRIES_DELAY","MAX_RETRIES_DELAY","Webphone","appKey","appName","appVersion","alert","auth","client","rolesAndPermissions","webphoneLogLevel","storage","options","actionTypes","_appKey","_appName","_appVersion","_alert","_webphoneLogLevel","_auth","_client","_rolesAndPermissions","_storage","_storageWebphoneCountsKey","_webphone","_remoteVideo","_localVideo","_activeSession","_sessions","_reducer","registerReducer","key","reducer","toggleMinimized","bind","answer","reject","resume","hangup","window","document","createElement","setAttribute","body","appendChild","onbeforeunload","disconnect","then","console","log","store","dispatch","type","init","videoElementPrepared","subscribe","_onStateChange","_shouldInit","initSuccess","_shouldReset","resetSuccess","loggedIn","ready","service","platform","post","sipInfo","transport","response","json","error","Error","getSipProvisionError","provisionData","uuid","endpoingId","logLevel","audioHelper","enabled","incoming","outgoing","onRegistered","registered","onUnregistered","unregistered","userAgent","removeAllListeners","onRegistrationFailed","registrationFailed","_connect","setVolume","on","once","session","_onInvite","reconnect","_retrySleep","connectionStatus","connecting","connectFailed","resetRetryCounts","connect","_sipProvision","sipProvision","disconnecting","_createWebphone","connectError","warning","message","ttl","allowDuplicates","hasFromNumber","checkIsLoggedIn","disconnected","browserNotSupported","webphoneCounts","webphoneCountOverLimit","notOutboundCallWithoutDL","connected","stop","unregister","forEach","callStatus","_updateCurrentSessionAndSessions","finished","_removeSession","cause","newSession","replaced","direction","inbound","_addSession","onAccepted","isOnMute","onMute","onHold","creationTime","Date","now","updateCurrentSession","sessionId","get","isOnHold","local","hold","_setActiveSession","_onAccepted","accept","acceptOptions","_resetMinimized","_removeActiveSession","unhold","forwardNumber","forward","ua","volume","mute","unmute","sessionItem","sessionItemId","id","startRecord","isOnRecord","stopRecord","park","transferNumber","transfer","invite","media","warmTransfer","flipValue","flip","dtmfValue","dtmf","terminate","e","toNumber","fromNumber","homeCountryId","outbound","set","updateSessions","sessions","_cleanActiveSession","delete","destroyCurrentSession","_updateCurrentSession","_updateSessions","resetMinimized","connectRetryCounts","state","status","minimized","currentSession","webphoneEnabled","getItem","render","remote"],"mappings":"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","file":"index.js","sourcesContent":["import RingCentralWebphone from 'ringcentral-web-phone';\nimport incomingAudio from 'ringcentral-web-phone/audio/incoming.ogg';\nimport outgoingAudio from 'ringcentral-web-phone/audio/outgoing.ogg';\n\nimport RcModule from '../../lib/RcModule';\nimport sleep from '../../lib/sleep';\nimport moduleStatus from '../../enums/moduleStatus';\nimport connectionStatus from './connectionStatus';\nimport sessionStatus from './sessionStatus';\nimport actionTypes from './actionTypes';\nimport callDirections from '../../enums/callDirections';\nimport webphoneErrors from './webphoneErrors';\n\nimport { isBrowerSupport } from './webphoneHelper';\nimport getWebphoneReducer, { getWebphoneCountsReducer } from './getWebphoneReducer';\n\nconst FIRST_THREE_RETRIES_DELAY = 10 * 1000;\nconst FOURTH_RETRIES_DELAY = 30 * 1000;\nconst FIFTH_RETRIES_DELAY = 60 * 1000;\nconst MAX_RETRIES_DELAY = 2 * 60 * 1000;\n\nexport default class Webphone extends RcModule {\n  constructor({\n    appKey,\n    appName,\n    appVersion,\n    alert,\n    auth,\n    client,\n    rolesAndPermissions,\n    webphoneLogLevel = 3,\n    storage,\n    ...options,\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._appKey = appKey;\n    this._appName = appName;\n    this._appVersion = appVersion;\n    this._alert = alert;\n    this._webphoneLogLevel = webphoneLogLevel;\n    this._auth = auth;\n    this._client = client;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._storage = storage;\n    this._storageWebphoneCountsKey = 'webphoneCounts';\n    this._webphone = null;\n    this._remoteVideo = null;\n    this._localVideo = null;\n\n    this._activeSession = null;\n    this._sessions = new Map();\n\n    this._reducer = getWebphoneReducer(this.actionTypes);\n\n    storage.registerReducer({\n      key: this._storageWebphoneCountsKey,\n      reducer: getWebphoneCountsReducer(this.actionTypes),\n    });\n\n    this.toggleMinimized = this.toggleMinimized.bind(this);\n    this.answer = this.answer.bind(this);\n    this.reject = this.reject.bind(this);\n    this.resume = this.resume.bind(this);\n    this.hangup = this.hangup.bind(this);\n  }\n\n  initialize() {\n    if (\n      typeof window !== 'undefined' &&\n      typeof document !== 'undefined'\n    ) {\n      this._remoteVideo = document.createElement('video');\n      this._remoteVideo.setAttribute('hidden', 'hidden');\n      this._localVideo = document.createElement('video');\n      this._localVideo.setAttribute('hidden', 'hidden');\n      this._localVideo.setAttribute('muted', 'muted');\n      document.body.appendChild(this._remoteVideo);\n      document.body.appendChild(this._localVideo);\n      window.onbeforeunload = () => {\n        this.disconnect().then(() => {\n          console.log('closed webrtc');\n        });\n      };\n      this.store.dispatch({\n        type: this.actionTypes.init,\n        videoElementPrepared: true,\n      });\n    } else {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n        videoElementPrepared: false,\n      });\n    }\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n      this.disconnect();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loggedIn &&\n      this._rolesAndPermissions.ready &&\n      !this.ready\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (\n        !this._auth.loggedIn ||\n        !this._rolesAndPermissions.ready\n      ) &&\n      this.ready\n    );\n  }\n\n  async _sipProvision() {\n    try {\n      const response = await this._client.service.platform()\n        .post('/client-info/sip-provision', {\n          sipInfo: [{ transport: 'WSS' }]\n        });\n      return response.json();\n    } catch (error) {\n      console.error(error);\n      throw new Error(webphoneErrors.getSipProvisionError);\n    }\n  }\n\n  _createWebphone(provisionData) {\n    this._webphone = new RingCentralWebphone(provisionData, {\n      appKey: this._appKey,\n      appName: this._appName,\n      appVersion: this._appVersion,\n      uuid: this._auth.endpoingId,\n      logLevel: this._webphoneLogLevel, // error 0, warn 1, log: 2, debug: 3\n      audioHelper: {\n        enabled: true, // enables audio feedback when web phone is ringing or making a call\n        incoming: incomingAudio, // path to audio file for incoming call\n        outgoing: outgoingAudio, // path to aduotfile for outgoing call\n      }\n    });\n\n    const onRegistered = () => {\n      this.store.dispatch({\n        type: this.actionTypes.registered,\n      });\n    };\n    const onUnregistered = () => {\n      this.store.dispatch({\n        type: this.actionTypes.unregistered,\n      });\n      this._webphone.userAgent.removeAllListeners();\n      this._webphone = null;\n    };\n    const onRegistrationFailed = (error) => {\n      this.store.dispatch({\n        type: this.actionTypes.registrationFailed,\n        error,\n      });\n      this._webphone.userAgent.removeAllListeners();\n      this._connect(true);\n    };\n    this._webphone.userAgent.audioHelper.setVolume(0.3);\n    this._webphone.userAgent.on('registered', onRegistered);\n    this._webphone.userAgent.on('unregistered', onUnregistered);\n    this._webphone.userAgent.once('registrationFailed', onRegistrationFailed);\n    this._webphone.userAgent.on('invite', (session) => {\n      console.log('UA invite');\n      this._onInvite(session);\n    });\n  }\n\n  async _connect(reconnect = false) {\n    try {\n      if (reconnect) {\n        await this._retrySleep();\n      }\n\n      // do not connect if it is connecting\n      if (this.connectionStatus === connectionStatus.connecting) {\n        return;\n      }\n\n      // when reconnect is break by disconnect\n      if (reconnect && this.connectionStatus !== connectionStatus.connectFailed) {\n        this.store.dispatch({\n          type: this.actionTypes.resetRetryCounts,\n        });\n        return;\n      }\n\n      this.store.dispatch({\n        type: (\n          reconnect ?\n            this.actionTypes.reconnect : this.actionTypes.connect\n        )\n      });\n\n      const sipProvision = await this._sipProvision();\n\n      // do not continue if it is disconnecting\n      if (this.connectionStatus === connectionStatus.disconnecting) {\n        return;\n      }\n      this._createWebphone(sipProvision);\n    } catch (error) {\n      this.store.dispatch({\n        type: this.actionTypes.connectError,\n        error,\n      });\n      this._alert.warning({\n        message: webphoneErrors.connectFailed,\n        ttl: 0,\n        allowDuplicates: false,\n      });\n      await this._connect(true);\n    }\n  }\n\n  async connect(hasFromNumber) {\n    if (\n      (await this._auth.checkIsLoggedIn()) &&\n      this.enabled &&\n      this.connectionStatus === connectionStatus.disconnected\n    ) {\n      if (!isBrowerSupport()) {\n        this._alert.warning({\n          message: webphoneErrors.browserNotSupported,\n          ttl: 0,\n        });\n        return;\n      }\n      if (this.webphoneCounts >= 5) {\n        this._alert.warning({\n          message: webphoneErrors.webphoneCountOverLimit,\n        });\n        return;\n      }\n      if (!hasFromNumber) {\n        this._alert.warning({\n          message: webphoneErrors.notOutboundCallWithoutDL,\n        });\n        return;\n      }\n      await this._connect();\n    }\n  }\n\n  async disconnect() {\n    if (\n      this.connectionStatus === connectionStatus.connected ||\n      this.connectionStatus === connectionStatus.connecting ||\n      this.connectionStatus === connectionStatus.connectFailed\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.disconnect,\n      });\n      if (this._webphone) {\n        this._webphone.userAgent.stop();\n        this._webphone.userAgent.unregister();\n        this._sessions.forEach((session) => {\n          this.hangup(session);\n        });\n      }\n    }\n  }\n\n  _onAccepted(session) {\n    session.on('accepted', () => {\n      console.log('accepted');\n      session.callStatus = sessionStatus.connected;\n      this._updateCurrentSessionAndSessions(session);\n    });\n    session.on('progress', () => {\n      console.log('progress...');\n      session.callStatus = sessionStatus.connecting;\n      this._updateCurrentSessionAndSessions(session);\n    });\n    session.on('rejected', () => {\n      console.log('rejected');\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('failed', (response, cause) => {\n      console.log('Event: Failed');\n      console.log(cause);\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('terminated', () => {\n      console.log('Event: Terminated');\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('cancel', () => {\n      console.log('Event: Cancel');\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('refer', () => {\n      console.log('Event: Refer');\n    });\n    session.on('replaced', (newSession) => {\n      session.callStatus = sessionStatus.replaced;\n      newSession.callStatus = sessionStatus.connected;\n      newSession.direction = callDirections.inbound;\n      this._addSession(newSession);\n      this.onAccepted(newSession);\n    });\n    session.on('muted', () => {\n      console.log('Event: Muted');\n      session.isOnMute = true;\n      session.callStatus = sessionStatus.onMute;\n    });\n    session.on('unmuted', () => {\n      console.log('Event: Unmuted');\n      session.isOnMute = false;\n      session.callStatus = sessionStatus.connected;\n    });\n    session.on('hold', () => {\n      console.log('Event: hold');\n      session.callStatus = sessionStatus.onHold;\n    });\n    session.on('unhold', () => {\n      console.log('Event: unhold');\n      session.callStatus = sessionStatus.connected;\n    });\n  }\n\n  _onInvite(session) {\n    session.creationTime = Date.now();\n    session.direction = callDirections.inbound;\n    session.callStatus = sessionStatus.connecting;\n    if (!this._activeSession) {\n      this._activeSession = session;\n      this.store.dispatch({\n        type: this.actionTypes.updateCurrentSession,\n        session,\n      });\n    }\n\n    this._addSession(session);\n    session.on('rejected', () => {\n      console.log('Event: Rejected');\n      this._removeSession(session);\n    });\n  }\n\n  async answer(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      if (\n        this._activeSession && !this._activeSession.isOnHold().local &&\n        this._activeSession !== session\n      ) {\n        this._activeSession.hold();\n      }\n      this._setActiveSession(session);\n      this._onAccepted(session, 'inbound');\n      await session.accept(this.acceptOptions);\n      this._resetMinimized();\n    } catch (e) {\n      console.log('Accept failed');\n      this._removeSession(session);\n      this._removeActiveSession();\n    }\n  }\n\n  reject(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.reject();\n  }\n\n  resume(sessionId) {\n    this.unhold(sessionId);\n    this._resetMinimized();\n  }\n\n  async forward(forwardNumber, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.forward(forwardNumber, this.acceptOptions);\n      console.log('Forwarded');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  increaseVolume(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.ua.audioHelper.setVolume(\n      (session.ua.audioHelper.volume != null ? session.ua.audioHelper.volume : 0.5) + 0.1\n    );\n  }\n\n  decreaseVolume(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.ua.audioHelper.setVolume(\n      (session.ua.audioHelper.volume != null ? session.ua.audioHelper.volume : 0.5) - 0.1\n    );\n  }\n\n  mute(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.isOnMute = true;\n    session.mute();\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  unmute(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.isOnMute = false;\n    session.unmute();\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  hold(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.hold();\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  unhold(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    if (session.isOnHold().local) {\n      session.unhold();\n    }\n    this._sessions.forEach((sessionItem, sessionItemId) => {\n      if (session.id !== sessionItemId) {\n        if (!sessionItem.isOnHold().local) {\n          sessionItem.hold();\n        }\n      }\n    });\n    this._setActiveSession(session);\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  async startRecord(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.startRecord();\n      session.isOnRecord = true;\n      console.log('Recording Started');\n    } catch (e) {\n      session.isOnRecord = false;\n      console.error(e);\n    }\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  async stopRecord(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.stopRecord();\n      session.isOnRecord = false;\n      console.log('Recording Stopped');\n    } catch (e) {\n      session.isOnRecord = true;\n      console.error(e);\n    }\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  async park(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.park();\n      console.log('Parked');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async transfer(transferNumber, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.transfer(transferNumber);\n      console.log('Transferred');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async transferWarm(transferNumber, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.hold();\n      const newSession = session.ua.invite(transferNumber, {\n        media: this.acceptOptions.media\n      });\n      newSession.once('accepted', async () => {\n        try {\n          await session.warmTransfer(newSession);\n          console.log('Transferred');\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async flip(flipValue, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.flip(flipValue);\n      console.log('Flipped');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  sendDTMF(dtmfValue, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.dtmf(dtmfValue);\n  }\n\n  hangup(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      session.terminate();\n    } catch (e) {\n      console.log(e);\n      this._removeSession(session);\n    }\n  }\n\n  makeCall({ toNumber, fromNumber, homeCountryId }) {\n    const session = this._webphone.userAgent.invite(toNumber, {\n      media: this.acceptOptions.media,\n      fromNumber,\n      homeCountryId,\n    });\n    session.direction = callDirections.outbound;\n    session.callStatus = sessionStatus.connecting;\n    session.creationTime = Date.now();\n    this._onAccepted(session);\n    if (this._activeSession && !this._activeSession.isOnHold().local) {\n      this._activeSession.hold();\n    }\n    this._addSession(session);\n    this._setActiveSession(session);\n    this._resetMinimized();\n    return session;\n  }\n\n  _addSession(session) {\n    this._sessions.set(session.id, session);\n    this.store.dispatch({\n      type: this.actionTypes.updateSessions,\n      sessions: this._sessions,\n    });\n  }\n\n  _removeSession(session) {\n    this._cleanActiveSession(session);\n    this._sessions.delete(session.id);\n    this.store.dispatch({\n      type: this.actionTypes.updateSessions,\n      sessions: this._sessions,\n    });\n  }\n\n  _setActiveSession(session) {\n    this._activeSession = session;\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentSession,\n      session,\n    });\n  }\n\n  _removeActiveSession() {\n    this._activeSession = null;\n    this.store.dispatch({\n      type: this.actionTypes.destroyCurrentSession,\n    });\n  }\n\n  _cleanActiveSession(session) {\n    if (session !== this._activeSession) {\n      return;\n    }\n    this._removeActiveSession();\n  }\n\n  _updateCurrentSessionAndSessions(session) {\n    if (session === this._activeSession) {\n      this._updateCurrentSession(session);\n    }\n    this._updateSessions();\n  }\n\n  _updateCurrentSession(session) {\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentSession,\n      session,\n    });\n  }\n\n  _updateSessions() {\n    this.store.dispatch({\n      type: this.actionTypes.updateSessions,\n      sessions: this._sessions,\n    });\n  }\n\n  toggleMinimized() {\n    this.store.dispatch({\n      type: this.actionTypes.toggleMinimized,\n    });\n  }\n\n  _resetMinimized() {\n    this.store.dispatch({\n      type: this.actionTypes.resetMinimized,\n    });\n  }\n\n  async _retrySleep() {\n    if (this.connectRetryCounts < 3) {\n      await sleep(FIRST_THREE_RETRIES_DELAY);\n    }\n    if (this.connectRetryCounts === 3) {\n      await sleep(FOURTH_RETRIES_DELAY);\n    }\n    if (this.connectRetryCounts === 4) {\n      await sleep(FIFTH_RETRIES_DELAY); // sleep 30 seconds\n    }\n    if (this.connectRetryCounts > 4) {\n      await sleep(MAX_RETRIES_DELAY); // sleep 30 seconds\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get activeSession() {\n    return this._activeSession;\n  }\n\n  get originalSessions() {\n    return this._sessions;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatus.ready;\n  }\n\n  get minimized() {\n    return this.state.minimized;\n  }\n\n  get currentSession() {\n    return this.state.currentSession;\n  }\n\n  get sessions() {\n    return this.state.sessions;\n  }\n\n  get videoElementPrepared() {\n    return this.state.videoElementPrepared;\n  }\n\n  get enabled() {\n    return this.videoElementPrepared && this._rolesAndPermissions.webphoneEnabled;\n  }\n\n  get connectionStatus() {\n    return this.state.connectionStatus;\n  }\n\n  get webphoneCounts() {\n    return this._storage.getItem(this._storageWebphoneCountsKey);\n  }\n\n  get connectRetryCounts() {\n    return this.state.connectRetryCounts;\n  }\n\n  get acceptOptions() {\n    return {\n      media: {\n        render: {\n          remote: this._remoteVideo,\n          local: this._localVideo,\n        }\n      }\n    };\n  }\n}\n"]}