{"version":3,"sources":["modules/Webphone/index.js"],"names":["FIRST_THREE_RETRIES_DELAY","FOURTH_RETRIES_DELAY","FIFTH_RETRIES_DELAY","MAX_RETRIES_DELAY","Webphone","appKey","appName","appVersion","alert","auth","client","rolesAndPermissions","webphoneLogLevel","storage","contactMatcher","options","actionTypes","_appKey","_appName","_appVersion","_alert","_webphoneLogLevel","_auth","_client","_rolesAndPermissions","_storage","_storageWebphoneCountsKey","_contactMatcher","_webphone","_remoteVideo","_localVideo","_activeSession","_sessions","_reducer","registerReducer","key","reducer","addSelector","sessions","outputs","forEach","session","push","to","from","addQuerySource","getQueriesFn","_selectors","sessionPhoneNumbers","readyCheckFn","ready","document","createElement","setAttribute","body","appendChild","store","dispatch","type","videoElementPrepared","window","readyState","addEventListener","_prepareVideoElement","_disconnect","subscribe","_onStateChange","_shouldInit","initSuccess","_shouldReset","resetSuccess","disconnect","loggedIn","service","platform","post","sipInfo","transport","response","json","provisionData","uuid","endpoingId","logLevel","audioHelper","enabled","incoming","outgoing","onRegistered","registered","onUnregistered","unregistered","userAgent","removeAllListeners","onRegistrationFailed","error","registrationFailed","reason_phrase","indexOf","warning","message","webphoneCountOverLimit","_connect","setVolume","on","once","console","debug","_onInvite","reconnect","_retrySleep","connectionStatus","connecting","connectFailed","resetRetryCounts","connect","_sipProvision","sipProvision","disconnecting","_createWebphone","connectError","ttl","allowDuplicates","refreshServiceFeatures","hasFromNumber","checkIsLoggedIn","disconnected","browserNotSupported","notOutboundCallWithoutDL","connected","stop","unregister","hangup","triggerMatch","log","callStatus","_updateCurrentSessionAndSessions","finished","_removeSession","cause","newSession","replaced","direction","inbound","_addSession","onAccepted","isOnMute","onMute","onHold","creationTime","Date","now","updateCurrentSession","_onNewCall","sessionId","get","isOnHold","local","hold","_setActiveSession","_onAccepted","accept","acceptOptions","_resetMinimized","_removeActiveSession","_sessionHandleWithId","reject","unhold","forwardNumber","forward","ua","volume","mute","unmute","sessionItem","sessionItemId","id","startRecord","isOnRecord","stopRecord","park","transferNumber","transfer","invite","media","warmTransfer","flipValue","flip","dtmfValue","dtmf","e","terminate","toVoiceMail","replyOptions","replyWithMessage","func","toNumber","fromNumber","homeCountryId","outbound","set","updateSessions","values","map","_cleanActiveSession","delete","destroyCurrentSession","_updateCurrentSession","_updateSessions","toggleMinimized","resetMinimized","connectRetryCounts","state","status","minimized","currentSession","webphoneEnabled","getItem","render","remote"],"mappings":"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","file":"index.js","sourcesContent":["import RingCentralWebphone from 'ringcentral-web-phone';\nimport incomingAudio from 'ringcentral-web-phone/audio/incoming.ogg';\nimport outgoingAudio from 'ringcentral-web-phone/audio/outgoing.ogg';\n\nimport RcModule from '../../lib/RcModule';\nimport sleep from '../../lib/sleep';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport connectionStatus from './connectionStatus';\nimport sessionStatus from './sessionStatus';\nimport actionTypes from './actionTypes';\nimport callDirections from '../../enums/callDirections';\nimport webphoneErrors from './webphoneErrors';\nimport proxify from '../../lib/proxy/proxify';\nimport {\n  isBrowerSupport,\n  patchUserAgent,\n  patchIncomingSession,\n  normalizeSession,\n} from './webphoneHelper';\nimport getWebphoneReducer, { getWebphoneCountsReducer } from './getWebphoneReducer';\n\nconst FIRST_THREE_RETRIES_DELAY = 10 * 1000;\nconst FOURTH_RETRIES_DELAY = 30 * 1000;\nconst FIFTH_RETRIES_DELAY = 60 * 1000;\nconst MAX_RETRIES_DELAY = 2 * 60 * 1000;\n\nexport default class Webphone extends RcModule {\n  constructor({\n    appKey,\n    appName,\n    appVersion,\n    alert,\n    auth,\n    client,\n    rolesAndPermissions,\n    webphoneLogLevel = 3,\n    storage,\n    contactMatcher,\n    ...options,\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._appKey = appKey;\n    this._appName = appName;\n    this._appVersion = appVersion;\n    this._alert = alert;\n    this._webphoneLogLevel = webphoneLogLevel;\n    this._auth = auth;\n    this._client = client;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._storage = storage;\n    this._storageWebphoneCountsKey = 'webphoneCounts';\n    this._contactMatcher = contactMatcher;\n    this._webphone = null;\n    this._remoteVideo = null;\n    this._localVideo = null;\n\n    this._activeSession = null;\n    this._sessions = new Map();\n\n    this._reducer = getWebphoneReducer(this.actionTypes);\n\n    storage.registerReducer({\n      key: this._storageWebphoneCountsKey,\n      reducer: getWebphoneCountsReducer(this.actionTypes),\n    });\n\n    this.addSelector('sessionPhoneNumbers',\n      () => this.sessions,\n      (sessions) => {\n        const outputs = [];\n        sessions.forEach((session) => {\n          outputs.push(session.to);\n          outputs.push(session.from);\n        });\n        return outputs;\n      }\n    );\n\n    if (this._contactMatcher) {\n      this._contactMatcher.addQuerySource({\n        getQueriesFn: this._selectors.sessionPhoneNumbers,\n        readyCheckFn: () => (\n          this.ready\n        ),\n      });\n    }\n  }\n\n  _prepareVideoElement() {\n    this._remoteVideo = document.createElement('video');\n    this._remoteVideo.setAttribute('hidden', 'hidden');\n    this._localVideo = document.createElement('video');\n    this._localVideo.setAttribute('hidden', 'hidden');\n    this._localVideo.setAttribute('muted', 'muted');\n    document.body.appendChild(this._remoteVideo);\n    document.body.appendChild(this._localVideo);\n\n    this.store.dispatch({\n      type: this.actionTypes.videoElementPrepared,\n    });\n  }\n  initialize() {\n    if (\n      typeof window !== 'undefined' &&\n      typeof document !== 'undefined'\n    ) {\n      if (document.readyState === 'loading') {\n        window.addEventListener('load', () => {\n          this._prepareVideoElement();\n        });\n      } else {\n        this._prepareVideoElement();\n      }\n      window.addEventListener('unload', () => {\n        this._disconnect();\n      });\n    }\n    this.store.subscribe(() => this._onStateChange());\n  }\n  // initializeProxy() {\n  //   navigator.webkitGetUserMedia({ audio: true });\n  // }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n      this.disconnect();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loggedIn &&\n      this._rolesAndPermissions.ready &&\n      !this.ready\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (\n        !this._auth.loggedIn ||\n        !this._rolesAndPermissions.ready\n      ) &&\n      this.ready\n    );\n  }\n  @proxify\n  async _sipProvision() {\n    const response = await this._client.service.platform()\n      .post('/client-info/sip-provision', {\n        sipInfo: [{ transport: 'WSS' }]\n      });\n    return response.json();\n  }\n  _createWebphone(provisionData) {\n    this._webphone = new RingCentralWebphone(provisionData, {\n      appKey: this._appKey,\n      appName: this._appName,\n      appVersion: this._appVersion,\n      uuid: this._auth.endpoingId,\n      logLevel: this._webphoneLogLevel, // error 0, warn 1, log: 2, debug: 3\n      audioHelper: {\n        enabled: true, // enables audio feedback when web phone is ringing or making a call\n        incoming: incomingAudio, // path to audio file for incoming call\n        outgoing: outgoingAudio, // path to aduotfile for outgoing call\n      }\n    });\n\n    const onRegistered = () => {\n      this.store.dispatch({\n        type: this.actionTypes.registered,\n      });\n    };\n    const onUnregistered = () => {\n      this.store.dispatch({\n        type: this.actionTypes.unregistered,\n      });\n      this._webphone.userAgent.removeAllListeners();\n      this._webphone = null;\n    };\n    const onRegistrationFailed = (error) => {\n      this.store.dispatch({\n        type: this.actionTypes.registrationFailed,\n        error,\n      });\n      this._webphone.userAgent.removeAllListeners();\n      this._webphone = null;\n      if (error && error.reason_phrase && error.reason_phrase.indexOf('Too Many Contacts') > -1) {\n        this._alert.warning({\n          message: webphoneErrors.webphoneCountOverLimit,\n        });\n        return;\n      }\n      this._connect(true);\n    };\n    this._webphone.userAgent.audioHelper.setVolume(0.3);\n    this._webphone.userAgent.on('registered', onRegistered);\n    this._webphone.userAgent.on('unregistered', onUnregistered);\n    this._webphone.userAgent.once('registrationFailed', onRegistrationFailed);\n    this._webphone.userAgent.on('invite', (session) => {\n      console.debug('UA invite');\n      this._onInvite(session);\n    });\n    patchUserAgent(this._webphone.userAgent);\n  }\n\n  @proxify\n  async _connect(reconnect = false) {\n    try {\n      if (reconnect) {\n        await this._retrySleep();\n      }\n\n      // do not connect if it is connecting\n      if (this.connectionStatus === connectionStatus.connecting) {\n        return;\n      }\n\n      // when reconnect is break by disconnect\n      if (reconnect && this.connectionStatus !== connectionStatus.connectFailed) {\n        this.store.dispatch({\n          type: this.actionTypes.resetRetryCounts,\n        });\n        return;\n      }\n\n      this.store.dispatch({\n        type: (\n          reconnect ?\n            this.actionTypes.reconnect : this.actionTypes.connect\n        )\n      });\n\n      const sipProvision = await this._sipProvision();\n\n      // do not continue if it is disconnecting\n      if (this.connectionStatus === connectionStatus.disconnecting) {\n        return;\n      }\n      this._createWebphone(sipProvision);\n    } catch (error) {\n      this.store.dispatch({\n        type: this.actionTypes.connectError,\n        error,\n      });\n      this._alert.warning({\n        message: webphoneErrors.connectFailed,\n        ttl: 0,\n        allowDuplicates: false,\n      });\n      if (\n        error && error.message &&\n        (error.message.indexOf('Feature [WebPhone] is not available') > -1)\n      ) {\n        this._rolesAndPermissions.refreshServiceFeatures();\n        return;\n      }\n      await this._connect(true);\n    }\n  }\n  @proxify\n  async connect(hasFromNumber) {\n    if (\n      (await this._auth.checkIsLoggedIn()) &&\n      this.enabled &&\n      this.connectionStatus === connectionStatus.disconnected\n    ) {\n      if (!isBrowerSupport()) {\n        this._alert.warning({\n          message: webphoneErrors.browserNotSupported,\n          ttl: 0,\n        });\n        return;\n      }\n      if (!hasFromNumber) {\n        this._alert.warning({\n          message: webphoneErrors.notOutboundCallWithoutDL,\n        });\n        return;\n      }\n      await this._connect();\n    }\n  }\n  _disconnect() {\n    if (\n      this.connectionStatus === connectionStatus.connected ||\n      this.connectionStatus === connectionStatus.connecting ||\n      this.connectionStatus === connectionStatus.connectFailed\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.disconnect,\n      });\n      if (this._webphone) {\n        this._webphone.userAgent.stop();\n        this._webphone.userAgent.unregister();\n        this._sessions.forEach((session) => {\n          this.hangup(session);\n        });\n      }\n    }\n  }\n  @proxify\n  async disconnect() {\n    this._disconnect();\n  }\n\n  _onNewCall() {\n    if (this._contactMatcher) {\n      this._contactMatcher.triggerMatch();\n    }\n  }\n\n  _onAccepted(session) {\n    session.on('accepted', () => {\n      console.log('accepted');\n      session.callStatus = sessionStatus.connected;\n      this._updateCurrentSessionAndSessions(session);\n    });\n    session.on('progress', () => {\n      console.log('progress...');\n      session.callStatus = sessionStatus.connecting;\n      this._updateCurrentSessionAndSessions(session);\n    });\n    session.on('rejected', () => {\n      console.log('rejected');\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('failed', (response, cause) => {\n      console.log('Event: Failed');\n      console.log(cause);\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('terminated', () => {\n      console.log('Event: Terminated');\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('cancel', () => {\n      console.log('Event: Cancel');\n      session.callStatus = sessionStatus.finished;\n      this._removeSession(session);\n    });\n    session.on('refer', () => {\n      console.log('Event: Refer');\n    });\n    session.on('replaced', (newSession) => {\n      session.callStatus = sessionStatus.replaced;\n      newSession.callStatus = sessionStatus.connected;\n      newSession.direction = callDirections.inbound;\n      this._addSession(newSession);\n      this.onAccepted(newSession);\n    });\n    session.on('muted', () => {\n      console.log('Event: Muted');\n      session.isOnMute = true;\n      session.callStatus = sessionStatus.onMute;\n    });\n    session.on('unmuted', () => {\n      console.log('Event: Unmuted');\n      session.isOnMute = false;\n      session.callStatus = sessionStatus.connected;\n    });\n    session.on('hold', () => {\n      console.log('Event: hold');\n      session.callStatus = sessionStatus.onHold;\n    });\n    session.on('unhold', () => {\n      console.log('Event: unhold');\n      session.callStatus = sessionStatus.connected;\n    });\n  }\n\n  _onInvite(session) {\n    session.creationTime = Date.now();\n    session.direction = callDirections.inbound;\n    session.callStatus = sessionStatus.connecting;\n    if (!this._activeSession) {\n      this._activeSession = session;\n      this.store.dispatch({\n        type: this.actionTypes.updateCurrentSession,\n        session: normalizeSession(session),\n      });\n    }\n    patchIncomingSession(session);\n    this._addSession(session);\n    session.on('rejected', () => {\n      console.log('Event: Rejected');\n      this._removeSession(session);\n    });\n    this._onNewCall();\n  }\n\n  @proxify\n  async answer(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      if (\n        this._activeSession && !this._activeSession.isOnHold().local &&\n        this._activeSession !== session\n      ) {\n        this._activeSession.hold();\n      }\n      this._setActiveSession(session);\n      this._onAccepted(session, 'inbound');\n      await session.accept(this.acceptOptions);\n      this._resetMinimized();\n    } catch (e) {\n      console.log('Accept failed');\n      this._removeSession(session);\n      this._removeActiveSession();\n    }\n  }\n  @proxify\n  async reject(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      session.reject();\n    });\n  }\n  @proxify\n  async resume(sessionId) {\n    this.unhold(sessionId);\n    this._resetMinimized();\n  }\n  @proxify\n  async forward(forwardNumber, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.forward(forwardNumber, this.acceptOptions);\n      console.log('Forwarded');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  @proxify\n  async increaseVolume(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      session.ua.audioHelper.setVolume(\n        (session.ua.audioHelper.volume != null ? session.ua.audioHelper.volume : 0.5) + 0.1\n      );\n    });\n  }\n  @proxify\n  async decreaseVolume(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      session.ua.audioHelper.setVolume(\n        (session.ua.audioHelper.volume != null ? session.ua.audioHelper.volume : 0.5) - 0.1\n      );\n    });\n  }\n  @proxify\n  async mute(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      session.isOnMute = true;\n      session.mute();\n      this._updateCurrentSessionAndSessions(session);\n    });\n  }\n  @proxify\n  async unmute(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      session.isOnMute = false;\n      session.unmute();\n      this._updateCurrentSessionAndSessions(session);\n    });\n  }\n\n  @proxify\n  async hold(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      session.hold();\n      this._updateCurrentSessionAndSessions(session);\n    });\n  }\n\n  @proxify\n  async unhold(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    if (session.isOnHold().local) {\n      session.unhold();\n    }\n    this._sessions.forEach((sessionItem, sessionItemId) => {\n      if (session.id !== sessionItemId) {\n        if (!sessionItem.isOnHold().local) {\n          sessionItem.hold();\n        }\n      }\n    });\n    this._setActiveSession(session);\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  @proxify\n  async startRecord(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.startRecord();\n      session.isOnRecord = true;\n      console.log('Recording Started');\n    } catch (e) {\n      session.isOnRecord = false;\n      console.error(e);\n    }\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  @proxify\n  async stopRecord(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.stopRecord();\n      session.isOnRecord = false;\n      console.log('Recording Stopped');\n    } catch (e) {\n      session.isOnRecord = true;\n      console.error(e);\n    }\n    this._updateCurrentSessionAndSessions(session);\n  }\n\n  @proxify\n  async park(sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.park();\n      console.log('Parked');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @proxify\n  async transfer(transferNumber, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.transfer(transferNumber);\n      console.log('Transferred');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @proxify\n  async transferWarm(transferNumber, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.hold();\n      const newSession = session.ua.invite(transferNumber, {\n        media: this.acceptOptions.media\n      });\n      newSession.once('accepted', async () => {\n        try {\n          await session.warmTransfer(newSession);\n          console.log('Transferred');\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @proxify\n  async flip(flipValue, sessionId) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    try {\n      await session.flip(flipValue);\n      console.log('Flipped');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @proxify\n  async sendDTMF(dtmfValue, sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      try {\n        session.dtmf(dtmfValue);\n      } catch (e) {\n        console.error(e);\n      }\n    });\n  }\n\n  @proxify\n  async hangup(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      try {\n        session.terminate();\n      } catch (e) {\n        console.error(e);\n        this._removeSession(session);\n      }\n    });\n  }\n\n  @proxify\n  async toVoiceMail(sessionId) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      try {\n        session.toVoiceMail();\n      } catch (e) {\n        console.error(e);\n        this._removeSession(session);\n      }\n    });\n  }\n\n  @proxify\n  async replyWithMessage(sessionId, replyOptions) {\n    this._sessionHandleWithId(sessionId, (session) => {\n      try {\n        session.replyWithMessage(replyOptions);\n      } catch (e) {\n        console.error(e);\n        this._removeSession(session);\n      }\n    });\n  }\n\n  _sessionHandleWithId(sessionId, func) {\n    const session = this._sessions.get(sessionId);\n    if (!session) {\n      return null;\n    }\n    return func(session);\n  }\n\n  @proxify\n  async makeCall({ toNumber, fromNumber, homeCountryId }) {\n    const session = this._webphone.userAgent.invite(toNumber, {\n      media: this.acceptOptions.media,\n      fromNumber,\n      homeCountryId,\n    });\n    session.direction = callDirections.outbound;\n    session.callStatus = sessionStatus.connecting;\n    session.creationTime = Date.now();\n    this._onAccepted(session);\n    if (this._activeSession && !this._activeSession.isOnHold().local) {\n      this._activeSession.hold();\n    }\n    this._addSession(session);\n    this._setActiveSession(session);\n    this._resetMinimized();\n    this._onNewCall();\n    return session;\n  }\n\n  _addSession(session) {\n    this._sessions.set(session.id, session);\n    this.store.dispatch({\n      type: this.actionTypes.updateSessions,\n      sessions: [...this._sessions.values()].map(normalizeSession),\n    });\n  }\n\n  _removeSession(session) {\n    this._cleanActiveSession(session);\n    this._sessions.delete(session.id);\n    this.store.dispatch({\n      type: this.actionTypes.updateSessions,\n      sessions: [...this._sessions.values()].map(normalizeSession),\n    });\n  }\n\n  _setActiveSession(session) {\n    this._activeSession = session;\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentSession,\n      session: normalizeSession(session),\n    });\n  }\n\n  _removeActiveSession() {\n    this._activeSession = null;\n    this.store.dispatch({\n      type: this.actionTypes.destroyCurrentSession,\n    });\n  }\n\n  _cleanActiveSession(session) {\n    if (session !== this._activeSession) {\n      return;\n    }\n    this._removeActiveSession();\n  }\n\n  _updateCurrentSessionAndSessions(session) {\n    if (session === this._activeSession) {\n      this._updateCurrentSession(session);\n    }\n    this._updateSessions();\n  }\n\n  _updateCurrentSession(session) {\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentSession,\n      session: normalizeSession(session),\n    });\n  }\n\n  _updateSessions() {\n    this.store.dispatch({\n      type: this.actionTypes.updateSessions,\n      sessions: [...this._sessions.values()].map(normalizeSession),\n    });\n  }\n\n  @proxify\n  async toggleMinimized() {\n    this.store.dispatch({\n      type: this.actionTypes.toggleMinimized,\n    });\n  }\n\n  _resetMinimized() {\n    this.store.dispatch({\n      type: this.actionTypes.resetMinimized,\n    });\n  }\n\n  async _retrySleep() {\n    if (this.connectRetryCounts < 3) {\n      await sleep(FIRST_THREE_RETRIES_DELAY);\n    }\n    if (this.connectRetryCounts === 3) {\n      await sleep(FOURTH_RETRIES_DELAY);\n    }\n    if (this.connectRetryCounts === 4) {\n      await sleep(FIFTH_RETRIES_DELAY); // sleep 30 seconds\n    }\n    if (this.connectRetryCounts > 4) {\n      await sleep(MAX_RETRIES_DELAY); // sleep 30 seconds\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get activeSession() {\n    return this._activeSession;\n  }\n\n  get originalSessions() {\n    return this._sessions;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  get minimized() {\n    return this.state.minimized;\n  }\n\n  get currentSession() {\n    return this.state.currentSession;\n  }\n\n  get sessions() {\n    return this.state.sessions;\n  }\n\n  get videoElementPrepared() {\n    return this.state.videoElementPrepared;\n  }\n\n  get enabled() {\n    return this._rolesAndPermissions.webphoneEnabled;\n  }\n\n  get connectionStatus() {\n    return this.state.connectionStatus;\n  }\n\n  get webphoneCounts() {\n    return this._storage.getItem(this._storageWebphoneCountsKey);\n  }\n\n  get connectRetryCounts() {\n    return this.state.connectRetryCounts;\n  }\n\n  get acceptOptions() {\n    return {\n      media: {\n        render: {\n          remote: this._remoteVideo,\n          local: this._localVideo,\n        }\n      }\n    };\n  }\n}\n"]}