{"version":3,"sources":["modules/ActiveCall/index.js"],"names":["ActiveCall","webphone","options","actionTypes","_webphone","_reducer","_session","toggleMinimized","bind","store","subscribe","_onStateChange","_shouldInit","dispatch","type","initSuccess","_shouldReset","resetSuccess","ready","activeSession","destroySession","newSession","state","status"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA;;;;;;IAEqBA,U;;;AACnB,4BAGG;AAAA,QAFDC,QAEC,QAFDA,QAEC;AAAA,QADEC,OACF;AAAA;;AAAA,yKAEIA,OAFJ;AAGCC;AAHD;;AAMD,UAAKC,SAAL,GAAiBH,QAAjB;AACA,UAAKI,QAAL,GAAgB,oCAAqB,MAAKF,WAA1B,CAAhB;;AAEA,UAAKG,QAAL,GAAgB,IAAhB;;AAEA,UAAKC,eAAL,GAAuB,MAAKA,eAAL,CAAqBC,IAArB,OAAvB;AAXC;AAYF;;;;iCAEY;AAAA;;AACX,WAAKC,KAAL,CAAWC,SAAX,CAAqB;AAAA,eAAM,OAAKC,cAAL,EAAN;AAAA,OAArB;AACD;;;qCAEgB;AACf,UAAI,KAAKC,WAAL,EAAJ,EAAwB;AACtB,aAAKH,KAAL,CAAWI,QAAX,CAAoB;AAClBC,gBAAM,KAAKX,WAAL,CAAiBY;AADL,SAApB;AAGD,OAJD,MAIO,IAAI,KAAKC,YAAL,EAAJ,EAAyB;AAC9B,aAAKP,KAAL,CAAWI,QAAX,CAAoB;AAClBC,gBAAM,KAAKX,WAAL,CAAiBc;AADL,SAApB;AAGD,OAJM,MAIA,IAAI,KAAKC,KAAT,EAAgB;AACrB,YAAI,KAAKZ,QAAL,KAAkB,KAAKF,SAAL,CAAee,aAArC,EAAoD;AAClD,eAAKb,QAAL,GAAgB,KAAKF,SAAL,CAAee,aAA/B;AACA,cAAI,KAAKb,QAAL,KAAkB,IAAtB,EAA4B;AAC1B,iBAAKG,KAAL,CAAWI,QAAX,CAAoB;AAClBC,oBAAM,KAAKX,WAAL,CAAiBiB;AADL,aAApB;AAGD,WAJD,MAIO;AACL,iBAAKX,KAAL,CAAWI,QAAX,CAAoB;AAClBC,oBAAM,KAAKX,WAAL,CAAiBkB;AADL,aAApB;AAGD;AACF;AACF;AACF;;;kCAEa;AACZ,aACE,CAAC,KAAKH,KAAN,IACA,KAAKd,SAAL,CAAec,KAFjB;AAID;;;mCAEc;AACb,aACE,KAAKA,KAAL,IACA,CAAC,KAAKd,SAAL,CAAec,KAFlB;AAID;;;sCAEiB;AAChB,WAAKT,KAAL,CAAWI,QAAX,CAAoB;AAClBC,cAAM,KAAKX,WAAL,CAAiBI;AADL,OAApB;AAGD;;;wBAEY;AACX,aAAO,KAAKe,KAAL,CAAWC,MAAlB;AACD;;;wBAEW;AACV,aAAO,KAAKD,KAAL,CAAWC,MAAX,KAAsB,uBAAaL,KAA1C;AACD;;;;;kBAzEkBlB,U","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport moduleStatus from '../../enums/moduleStatus';\nimport actionTypes from './actionTypes';\n\nimport getActiveCallReducer from './getActiveCallReducer';\n\nexport default class ActiveCall extends RcModule {\n  constructor({\n    webphone,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n\n    this._webphone = webphone;\n    this._reducer = getActiveCallReducer(this.actionTypes);\n\n    this._session = null;\n\n    this.toggleMinimized = this.toggleMinimized.bind(this);\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    } else if (this.ready) {\n      if (this._session !== this._webphone.activeSession) {\n        this._session = this._webphone.activeSession;\n        if (this._session === null) {\n          this.store.dispatch({\n            type: this.actionTypes.destroySession,\n          });\n        } else {\n          this.store.dispatch({\n            type: this.actionTypes.newSession,\n          });\n        }\n      }\n    }\n  }\n\n  _shouldInit() {\n    return (\n      !this.ready &&\n      this._webphone.ready\n    );\n  }\n\n  _shouldReset() {\n    return (\n      this.ready &&\n      !this._webphone.ready\n    );\n  }\n\n  toggleMinimized() {\n    this.store.dispatch({\n      type: this.actionTypes.toggleMinimized,\n    });\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatus.ready;\n  }\n}\n"]}