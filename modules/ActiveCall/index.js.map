{"version":3,"sources":["modules/ActiveCall/index.js"],"names":["ActiveCall","webphone","options","actionTypes","_webphone","_reducer","_session","toggleMinimized","bind","hangup","store","subscribe","_onStateChange","_shouldInit","dispatch","type","initSuccess","_shouldReset","resetSuccess","ready","activeSession","destroySession","newSession","id","state","status","minimized","sessionId"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA;;;;;;IAEqBA,U;;;AACnB,4BAGG;AAAA,QAFDC,QAEC,QAFDA,QAEC;AAAA,QADEC,OACF;AAAA;;AAAA,yKAEIA,OAFJ;AAGCC;AAHD;;AAMD,UAAKC,SAAL,GAAiBH,QAAjB;AACA,UAAKI,QAAL,GAAgB,oCAAqB,MAAKF,WAA1B,CAAhB;;AAEA,UAAKG,QAAL,GAAgB,IAAhB;;AAEA,UAAKC,eAAL,GAAuB,MAAKA,eAAL,CAAqBC,IAArB,OAAvB;AACA,UAAKC,MAAL,GAAc,MAAKA,MAAL,CAAYD,IAAZ,OAAd;AAZC;AAaF;;;;iCAEY;AAAA;;AACX,WAAKE,KAAL,CAAWC,SAAX,CAAqB;AAAA,eAAM,OAAKC,cAAL,EAAN;AAAA,OAArB;AACD;;;qCAEgB;AACf,UAAI,KAAKC,WAAL,EAAJ,EAAwB;AACtB,aAAKH,KAAL,CAAWI,QAAX,CAAoB;AAClBC,gBAAM,KAAKZ,WAAL,CAAiBa;AADL,SAApB;AAGD,OAJD,MAIO,IAAI,KAAKC,YAAL,EAAJ,EAAyB;AAC9B,aAAKP,KAAL,CAAWI,QAAX,CAAoB;AAClBC,gBAAM,KAAKZ,WAAL,CAAiBe;AADL,SAApB;AAGD,OAJM,MAIA,IAAI,KAAKC,KAAT,EAAgB;AACrB,YAAI,KAAKb,QAAL,KAAkB,KAAKF,SAAL,CAAegB,aAArC,EAAoD;AAClD,eAAKd,QAAL,GAAgB,KAAKF,SAAL,CAAegB,aAA/B;AACA,cAAI,KAAKd,QAAL,KAAkB,IAAtB,EAA4B;AAC1B,iBAAKI,KAAL,CAAWI,QAAX,CAAoB;AAClBC,oBAAM,KAAKZ,WAAL,CAAiBkB;AADL,aAApB;AAGD,WAJD,MAIO;AACL,iBAAKX,KAAL,CAAWI,QAAX,CAAoB;AAClBC,oBAAM,KAAKZ,WAAL,CAAiBmB,UADL;AAElBC,kBAAI,KAAKjB,QAAL,CAAciB;AAFA,aAApB;AAID;AACF;AACF;AACF;;;kCAEa;AACZ,aACE,CAAC,KAAKJ,KAAN,IACA,KAAKf,SAAL,CAAee,KAFjB;AAID;;;mCAEc;AACb,aACE,KAAKA,KAAL,IACA,CAAC,KAAKf,SAAL,CAAee,KAFlB;AAID;;;sCAEiB;AAChB,WAAKT,KAAL,CAAWI,QAAX,CAAoB;AAClBC,cAAM,KAAKZ,WAAL,CAAiBI;AADL,OAApB;AAGD;;;6BAEQ;AACP,UAAI,CAAC,KAAKD,QAAN,IAAkB,CAAC,KAAKF,SAA5B,EAAuC;AACrC;AACD;AACD,WAAKA,SAAL,CAAeK,MAAf,CAAsB,KAAKL,SAAL,CAAegB,aAArC;AACD;;;wBAEY;AACX,aAAO,KAAKI,KAAL,CAAWC,MAAlB;AACD;;;wBAEW;AACV,aAAO,KAAKD,KAAL,CAAWC,MAAX,KAAsB,uBAAaN,KAA1C;AACD;;;wBAEe;AACd,aAAO,KAAKK,KAAL,CAAWE,SAAlB;AACD;;;wBAEY;AACX,aAAO,CAAC,CAAC,KAAKF,KAAL,CAAWG,SAApB;AACD;;;;;kBA1FkB3B,U","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport moduleStatus from '../../enums/moduleStatus';\nimport actionTypes from './actionTypes';\n\nimport getActiveCallReducer from './getActiveCallReducer';\n\nexport default class ActiveCall extends RcModule {\n  constructor({\n    webphone,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n\n    this._webphone = webphone;\n    this._reducer = getActiveCallReducer(this.actionTypes);\n\n    this._session = null;\n\n    this.toggleMinimized = this.toggleMinimized.bind(this);\n    this.hangup = this.hangup.bind(this);\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    } else if (this.ready) {\n      if (this._session !== this._webphone.activeSession) {\n        this._session = this._webphone.activeSession;\n        if (this._session === null) {\n          this.store.dispatch({\n            type: this.actionTypes.destroySession,\n          });\n        } else {\n          this.store.dispatch({\n            type: this.actionTypes.newSession,\n            id: this._session.id,\n          });\n        }\n      }\n    }\n  }\n\n  _shouldInit() {\n    return (\n      !this.ready &&\n      this._webphone.ready\n    );\n  }\n\n  _shouldReset() {\n    return (\n      this.ready &&\n      !this._webphone.ready\n    );\n  }\n\n  toggleMinimized() {\n    this.store.dispatch({\n      type: this.actionTypes.toggleMinimized,\n    });\n  }\n\n  hangup() {\n    if (!this._session || !this._webphone) {\n      return;\n    }\n    this._webphone.hangup(this._webphone.activeSession);\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatus.ready;\n  }\n\n  get minimized() {\n    return this.state.minimized;\n  }\n\n  get active() {\n    return !!this.state.sessionId;\n  }\n}\n"]}